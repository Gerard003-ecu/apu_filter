.2025-09-16 17:05:11,176 - INFO - Cache miss.
2025-09-16 17:05:11,177 - INFO - Procesando archivos: test_uploads/b0416020-46dd-426e-aafa-f54ac193a536/presupuesto_1758060311_presupuesto.csv, test_uploads/b0416020-46dd-426e-aafa-f54ac193a536/apus_1758060311_apus.csv, test_uploads/b0416020-46dd-426e-aafa-f54ac193a536/insumos_1758060311_insumos.csv
2025-09-16 17:05:11,188 - INFO - Éxito al leerpresupuesto_1758060311_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 17:05:11,229 - INFO - Tipos de datos optimizados con PyArrow para test_uploads/b0416020-46dd-426e-aafa-f54ac193a536/presupuesto_1758060311_presupuesto.csv
2025-09-16 17:05:11,373 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 17:05:11,399 - INFO - --- Procesamiento completado ---
2025-09-16 17:05:11,447 - INFO - Cache info: hits=0, misses=1, size=1
.2025-09-16 17:05:11,479 - INFO - Cache miss.
2025-09-16 17:05:11,479 - INFO - Procesando archivos: test_uploads/77a1b005-345f-44ef-a06f-ebcb9cc93bd5/presupuesto_1758060311_presupuesto.csv, test_uploads/77a1b005-345f-44ef-a06f-ebcb9cc93bd5/apus_1758060311_apus.csv, test_uploads/77a1b005-345f-44ef-a06f-ebcb9cc93bd5/insumos_1758060311_insumos.csv
2025-09-16 17:05:11,485 - INFO - Éxito al leerpresupuesto_1758060311_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 17:05:11,492 - INFO - Tipos de datos optimizados con PyArrow para test_uploads/77a1b005-345f-44ef-a06f-ebcb9cc93bd5/presupuesto_1758060311_presupuesto.csv
2025-09-16 17:05:11,603 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 17:05:11,645 - INFO - --- Procesamiento completado ---
2025-09-16 17:05:11,707 - INFO - Cache info: hits=0, misses=2, size=2
2025-09-16 17:05:11,712 - INFO - Solicitud POST a /api/estimate con sesión: 77a1b005-345f-44ef-a06f-ebcb9cc93bd5
2025-09-16 17:05:11,712 - INFO - Parámetros recibidos en /api/estimate: {'cuadrilla': '5', 'material': 'TST', 'tipo': 'CUBIERTA'}
2025-09-16 17:05:11,737 - INFO - Resultado de calculate_estimate: {'valor_suministro': 0.0, 'valor_instalacion': np.float64(80000.0), 'tiempo_instalacion': np.float64(8.0), 'apu_encontrado': 'Suministro: N/A | Instalación: MANO DE OBRA INSTALACION TEJA SENCILLA CUADRILLA DE 5', 'log': "Parámetros de entrada: {'cuadrilla': '5', 'material': 'TST', 'tipo': 'CUBIERTA'}\nParámetros mapeados: material='TEJA SENCILLA', tipo='INSTALACION'\n\n--- BÚSQUEDA DE SUMINISTRO ---\nBuscando la mejor coincidencia para'TEJA SENCILLA' en 0 opciones.\nNo se encontró una buena coincidencia para el suministro.\nEncontrados 0 candidatos para suministro.\nADVERTENCIA: No se encontró un APU de suministro directo. Iniciando fallback a insumos.\nERROR (Fallback): Material no encontrado en lista de insumos.\n\n--- BÚSQUEDA DE INSTALACIÓN ---\nPaso A: 1 APUs encontrados con 'MANO DE OBRA' e 'INSTALACION'.\nPaso B: 1APUs restantes tras filtrar por 'TEJA SENCILLA'.\nPaso C: 1 APUs restantes tras filtrar por 'CUADRILLA DE 5'.\nÉXITO: APU de Instalación seleccionado: 'MANO DE OBRA INSTALACION TEJA SENCILLA CUADRILLA DE 5'\n\n--- CÁLCULO DE COSTOS Y TIEMPO ---\nCosto Instalación Base (MO+EQ): $80,000 | Tiempo: 8.0000 días/un\n\n--- RESULTADO FINAL ---\nValor Suministro: $0\nValor Instalación: $80,000"}
.2025-09-16 17:05:11,759 - INFO - Cache miss.
2025-09-16 17:05:11,761 - INFO - Procesando archivos: test_uploads/9a8e238e-202c-4942-83f9-1b9075790083/presupuesto_1758060311_presupuesto.csv, test_uploads/9a8e238e-202c-4942-83f9-1b9075790083/apus_1758060311_apus.csv, test_uploads/9a8e238e-202c-4942-83f9-1b9075790083/insumos_1758060311_insumos.csv
2025-09-16 17:05:11,768 - INFO - Éxito al leerpresupuesto_1758060311_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 17:05:11,773 - INFO - Tipos de datos optimizados con PyArrow para test_uploads/9a8e238e-202c-4942-83f9-1b9075790083/presupuesto_1758060311_presupuesto.csv
2025-09-16 17:05:11,886 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 17:05:11,918 - INFO - --- Procesamiento completado ---
2025-09-16 17:05:11,973 - INFO - Cache info: hits=0, misses=3, size=3
.2025-09-16 17:05:12,030 - INFO - Cache miss.
2025-09-16 17:05:12,032 - INFO - Procesando archivos: test_presupuesto.csv, test_apus.csv, test_insumos.csv
2025-09-16 17:05:12,037 - INFO - Éxito al leertest_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 17:05:12,041 - INFO - Tipos de datos optimizados con PyArrow para test_presupuesto.csv
2025-09-16 17:05:12,154 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 17:05:12,185 - INFO - --- Procesamiento completado ---
2025-09-16 17:05:12,244 - INFO - Cache info: hits=0, misses=1, size=1
2025-09-16 17:05:12,246 - INFO - Cache info: hits=1, misses=1, size=1
2025-09-16 17:05:12,248 - INFO - Caché limpiado forzosamente y procesando sin caché.
2025-09-16 17:05:12,249 - INFO - Procesando archivos: test_presupuesto.csv, test_apus.csv, test_insumos.csv
2025-09-16 17:05:12,256 - INFO - Éxito al leertest_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 17:05:12,265 - INFO - Tipos de datos optimizados con PyArrow para test_presupuesto.csv
2025-09-16 17:05:12,373 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 17:05:12,402 - INFO - --- Procesamiento completado ---
.2025-09-16 17:05:12,449 - INFO - Cache miss.
2025-09-16 17:05:12,449 - INFO - Procesando archivos: test_presupuesto.csv, test_apus.csv, test_insumos.csv
2025-09-16 17:05:12,454 - INFO - Éxito al leertest_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 17:05:12,460 - INFO - Tipos de datos optimizados con PyArrow para test_presupuesto.csv
2025-09-16 17:05:12,568 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 17:05:12,600 - INFO - --- Procesamiento completado ---
2025-09-16 17:05:12,649 - INFO - Cache info: hits=0, misses=1, size=1
..2025-09-16 17:05:12,685 - INFO - Cache miss.
2025-09-16 17:05:12,687 - INFO - Procesando archivos: test_presupuesto.csv, test_apus.csv, test_insumos.csv
2025-09-16 17:05:12,697 - INFO - Éxito al leertest_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 17:05:12,704 - INFO - Tipos de datos optimizados con PyArrow para test_presupuesto.csv
2025-09-16 17:05:12,864 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 17:05:12,992 - INFO - --- Procesamiento completado ---
2025-09-16 17:05:13,207 - INFO - Cache info: hits=0, misses=1, size=1
.2025-09-16 17:05:13,254 - INFO - Cache miss.
2025-09-16 17:05:13,254 - INFO - Procesando archivos: test_presupuesto_comma.csv, test_apus_comma.csv, test_insumos_comma.csv
2025-09-16 17:05:13,284 - INFO - Éxito al leertest_presupuesto_comma.csv con encoding 'latin1'y delimitador ','
2025-09-16 17:05:13,296 - INFO - Tipos de datos optimizados con PyArrow para test_presupuesto_comma.csv
2025-09-16 17:05:13,327 - WARNING - No se extrajeron datos de APU de test_apus_comma.csv
2025-09-16 17:05:13,330 - INFO - Cache info: hits=0, misses=1, size=1
F2025-09-16 17:05:13,340 - INFO - Cache miss.
2025-09-16 17:05:13,341 - INFO - Procesando archivos: test_presupuesto.csv, test_apus.csv, test_insumos.csv
2025-09-16 17:05:13,348 - INFO - Éxito al leertest_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 17:05:13,352 - INFO - Tipos de datos optimizados con PyArrow para test_presupuesto.csv
2025-09-16 17:05:13,488 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 17:05:13,524 - INFO - --- Procesamiento completado ---
2025-09-16 17:05:13,573 - INFO - Cache info: hits=0, misses=1, size=1
.2025-09-16 17:05:13,576 - INFO - Cache miss.
2025-09-16 17:05:13,577 - INFO - Procesando archivos: test_presupuesto.csv, test_malformed_apus.csv, test_insumos.csv
2025-09-16 17:05:13,583 - INFO - Éxito al leertest_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 17:05:13,590 - INFO - Tipos de datos optimizados con PyArrow para test_presupuesto.csv
2025-09-16 17:05:13,715 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 17:05:13,741 - INFO - --- Procesamiento completado ---
2025-09-16 17:05:13,795 - INFO - Cache info: hits=0, misses=1, size=1
....2025-09-16 17:05:13,835 - ERROR - No se pudo leer non_existent_file.csv con ninguna combinación.
2025-09-16 17:05:13,842 - INFO - Éxito al leertest_encoding.csv con encoding 'latin1'y delimitador ';'
2025-09-16 17:05:13,845 - INFO - Tipos de datos optimizados con PyArrow para test_encoding.csv
2025-09-16 17:05:15,117 - INFO - Éxito al leer Excel test.xlsx
2025-09-16 17:05:15,120 - INFO - Tipos de datos optimizados con PyArrow para test.xlsx
.
======================================================================
FAIL: test_process_all_files_comma_delimited (__main__.TestCSVProcessor.test_process_all_files_comma_delimited)
Prueba el procesamiento de archivos CSV delimitados por comas.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/gerardo/.local/share/uv/python/cpython-3.12.11-linux-x86_64-gnu/lib/python3.12/unittest/mock.py", line 1396, in patched
    return func(*newargs, **newkeywargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/gerardo/Documentos/GitHub/apu_filter/tests/test_app.py", line 263, in test_process_all_files_comma_delimited
    self.assertNotIn("error", resultado)
AssertionError: 'error' unexpectedly found in {'error': 'Uno o más archivos no pudieron ser procesados.'}

----------------------------------------------------------------------
Ran 15 tests in 4.001s

FAILED (failures=1)