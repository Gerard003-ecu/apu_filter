.2025-09-16 18:24:43,250 - INFO - Cache miss.
2025-09-16 18:24:43,250 - INFO - Procesando archivos: test_uploads/78ad6538-c48f-432f-885e-37dedb9c9983/presupuesto_1758065083_presupuesto.csv, test_uploads/78ad6538-c48f-432f-885e-37dedb9c9983/apus_1758065083_apus.csv, test_uploads/78ad6538-c48f-432f-885e-37dedb9c9983/insumos_1758065083_insumos.csv
2025-09-16 18:24:43,292 - INFO - Éxito al leerpresupuesto_1758065083_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 18:24:43,381 - INFO - Tipos de datos optimizados con PyArrow para test_uploads/78ad6538-c48f-432f-885e-37dedb9c9983/presupuesto_1758065083_presupuesto.csv
2025-09-16 18:24:43,559 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 18:24:43,585 - INFO - --- Procesamiento completado ---
2025-09-16 18:24:43,634 - INFO - Cache info: hits=0, misses=1, size=1
.2025-09-16 18:24:43,666 - INFO - Cache miss.
2025-09-16 18:24:43,666 - INFO - Procesando archivos: test_uploads/1a46668a-b6b9-4ca8-ac0c-9a10a2efabe3/presupuesto_1758065083_presupuesto.csv, test_uploads/1a46668a-b6b9-4ca8-ac0c-9a10a2efabe3/apus_1758065083_apus.csv, test_uploads/1a46668a-b6b9-4ca8-ac0c-9a10a2efabe3/insumos_1758065083_insumos.csv
2025-09-16 18:24:43,676 - INFO - Éxito al leerpresupuesto_1758065083_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 18:24:43,686 - INFO - Tipos de datos optimizados con PyArrow para test_uploads/1a46668a-b6b9-4ca8-ac0c-9a10a2efabe3/presupuesto_1758065083_presupuesto.csv
2025-09-16 18:24:43,870 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 18:24:43,899 - INFO - --- Procesamiento completado ---
2025-09-16 18:24:43,986 - INFO - Cache info: hits=0, misses=2, size=2
2025-09-16 18:24:43,999 - INFO - Solicitud POST a /api/estimate con sesión: 1a46668a-b6b9-4ca8-ac0c-9a10a2efabe3
2025-09-16 18:24:44,003 - INFO - Parámetros recibidos en /api/estimate: {'cuadrilla': '5', 'material': 'TST', 'tipo': 'CUBIERTA'}
2025-09-16 18:24:44,029 - INFO - Resultado de calculate_estimate: {'error': 'No se encontró un APU de instalación que coincida con todos los criterios.', 'log': "Parámetros de entrada: {'cuadrilla': '5', 'material': 'TST', 'tipo': 'CUBIERTA'}\nParámetros mapeados: material='TEJA SENCILLA', tipo='INSTALACION'\n\n--- BÚSQUEDA DE SUMINISTRO ---\nBuscando la mejor coincidencia para'TEJA SENCILLA' en 0 opciones.\nNo se encontró una buena coincidencia para el suministro.\nEncontrados 0 candidatos para suministro.\nADVERTENCIA: No se encontró un APU de suministro directo. Iniciando fallback a insumos.\nERROR (Fallback): Material no encontrado en lista de insumos.\n\n--- BÚSQUEDA DE INSTALACIÓN ---\nPaso A: 0 APUs encontrados con 'MANO DE OBRA' e 'INSTALACION'.\nPaso B: 0APUs restantes tras filtrar por 'TEJA SENCILLA'.\nPaso C: 0 APUs restantes tras filtrar por 'CUADRILLA DE 5'.\nERROR: No se encontró un APU de instalación que coincida con todos los criterios."}
2025-09-16 18:24:44,031 - WARNING - Error retornado por calculate_estimate: No se encontró un APU de instalación que coincida con todos los criterios.
F2025-09-16 18:24:44,076 - INFO - Cache miss.
2025-09-16 18:24:44,076 - INFO - Procesando archivos: test_uploads/368b7d5d-b7bf-403d-9451-1ebadf31314d/presupuesto_1758065084_presupuesto.csv, test_uploads/368b7d5d-b7bf-403d-9451-1ebadf31314d/apus_1758065084_apus.csv, test_uploads/368b7d5d-b7bf-403d-9451-1ebadf31314d/insumos_1758065084_insumos.csv
2025-09-16 18:24:44,087 - INFO - Éxito al leerpresupuesto_1758065084_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 18:24:44,094 - INFO - Tipos de datos optimizados con PyArrow para test_uploads/368b7d5d-b7bf-403d-9451-1ebadf31314d/presupuesto_1758065084_presupuesto.csv
2025-09-16 18:24:44,244 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 18:24:44,301 - INFO - --- Procesamiento completado ---
2025-09-16 18:24:44,370 - INFO - Cache info: hits=0, misses=3, size=3
.2025-09-16 18:24:44,458 - INFO - Cache miss.
2025-09-16 18:24:44,459 - INFO - Procesando archivos: test_presupuesto.csv, test_apus.csv, test_insumos.csv
2025-09-16 18:24:44,468 - INFO - Éxito al leertest_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 18:24:44,473 - INFO - Tipos de datos optimizados con PyArrow para test_presupuesto.csv
2025-09-16 18:24:44,608 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 18:24:44,651 - INFO - --- Procesamiento completado ---
2025-09-16 18:24:44,711 - INFO - Cache info: hits=0, misses=1, size=1
2025-09-16 18:24:44,711 - INFO - Cache info: hits=1, misses=1, size=1
2025-09-16 18:24:44,712 - INFO - Caché limpiado forzosamente y procesando sin caché.
2025-09-16 18:24:44,712 - INFO - Procesando archivos: test_presupuesto.csv, test_apus.csv, test_insumos.csv
2025-09-16 18:24:44,722 - INFO - Éxito al leertest_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 18:24:44,726 - INFO - Tipos de datos optimizados con PyArrow para test_presupuesto.csv
2025-09-16 18:24:44,872 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 18:24:44,908 - INFO - --- Procesamiento completado ---
.2025-09-16 18:24:44,954 - INFO - Cache miss.
2025-09-16 18:24:44,955 - INFO - Procesando archivos: test_presupuesto.csv, test_apus.csv, test_insumos.csv
2025-09-16 18:24:44,959 - INFO - Éxito al leertest_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 18:24:44,966 - INFO - Tipos de datos optimizados con PyArrow para test_presupuesto.csv
2025-09-16 18:24:45,150 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 18:24:45,179 - INFO - --- Procesamiento completado ---
2025-09-16 18:24:45,231 - INFO - Cache info: hits=0, misses=1, size=1
F.2025-09-16 18:24:45,255 - INFO - Cache miss.
2025-09-16 18:24:45,255 - INFO - Procesando archivos: test_presupuesto.csv, test_apus.csv, test_insumos.csv
2025-09-16 18:24:45,271 - INFO - Éxito al leertest_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 18:24:45,275 - INFO - Tipos de datos optimizados con PyArrow para test_presupuesto.csv
2025-09-16 18:24:45,410 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 18:24:45,520 - INFO - --- Procesamiento completado ---
2025-09-16 18:24:45,598 - INFO - Cache info: hits=0, misses=1, size=1
F2025-09-16 18:24:45,623 - INFO - Cache miss.
2025-09-16 18:24:45,626 - INFO - Procesando archivos: test_presupuesto_comma.csv, test_apus_comma.csv, test_insumos_comma.csv
2025-09-16 18:24:45,648 - INFO - Éxito al leertest_presupuesto_comma.csv con encoding 'latin1'y delimitador ','
2025-09-16 18:24:45,652 - INFO - Tipos de datos optimizados con PyArrow para test_presupuesto_comma.csv
2025-09-16 18:24:45,794 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 18:24:45,829 - INFO - --- Procesamiento completado ---
2025-09-16 18:24:45,878 - INFO - Cache info: hits=0, misses=1, size=1
.2025-09-16 18:24:45,884 - INFO - Cache miss.
2025-09-16 18:24:45,884 - INFO - Procesando archivos: test_presupuesto.csv, test_apus.csv, test_insumos.csv
2025-09-16 18:24:45,891 - INFO - Éxito al leertest_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 18:24:45,896 - INFO - Tipos de datos optimizados con PyArrow para test_presupuesto.csv
2025-09-16 18:24:46,016 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 18:24:46,046 - INFO - --- Procesamiento completado ---
2025-09-16 18:24:46,098 - INFO - Cache info: hits=0, misses=1, size=1
.2025-09-16 18:24:46,101 - INFO - Cache miss.
2025-09-16 18:24:46,102 - INFO - Procesando archivos: test_presupuesto.csv, test_malformed_apus.csv, test_insumos.csv
2025-09-16 18:24:46,111 - INFO - Éxito al leertest_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 18:24:46,116 - INFO - Tipos de datos optimizados con PyArrow para test_presupuesto.csv
2025-09-16 18:24:46,228 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 18:24:46,253 - INFO - --- Procesamiento completado ---
2025-09-16 18:24:46,296 - INFO - Cache info: hits=0, misses=1, size=1
....2025-09-16 18:24:46,344 - ERROR - No se pudo leer non_existent_file.csv con ninguna combinación.
2025-09-16 18:24:46,358 - INFO - Éxito al leertest_encoding.csv con encoding 'latin1'y delimitador ';'
2025-09-16 18:24:46,367 - INFO - Tipos de datos optimizados con PyArrow para test_encoding.csv
2025-09-16 18:24:47,087 - INFO - Éxito al leer Excel test.xlsx
2025-09-16 18:24:47,089 - INFO - Tipos de datos optimizados con PyArrow para test.xlsx
.
======================================================================
FAIL: test_07_get_estimate_with_session (__main__.TestAppEndpoints.test_07_get_estimate_with_session)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/gerardo/.local/share/uv/python/cpython-3.12.11-linux-x86_64-gnu/lib/python3.12/unittest/mock.py", line 1396, in patched
    return func(*newargs, **newkeywargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/gerardo/Documentos/GitHub/apu_filter/tests/test_app.py", line 415, in test_07_get_estimate_with_session
    self.assertEqual(response.status_code, 200)
AssertionError: 404 != 200

======================================================================
FAIL: test_calculate_estimate (__main__.TestCSVProcessor.test_calculate_estimate)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/gerardo/.local/share/uv/python/cpython-3.12.11-linux-x86_64-gnu/lib/python3.12/unittest/mock.py", line 1396, in patched
    return func(*newargs, **newkeywargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/gerardo/Documentos/GitHub/apu_filter/tests/test_app.py", line 300, in test_calculate_estimate
    self.assertNotIn("error", result)
AssertionError: 'error' unexpectedly found in {'error': 'No se encontró un APU de instalación que coincida con todos los criterios.', 'log': "Parámetros de entrada: {'tipo': 'CUBIERTA', 'material': 'TST', 'cuadrilla': '5'}\nParámetros mapeados: material='TEJA SENCILLA', tipo='INSTALACION'\n\n--- BÚSQUEDA DE SUMINISTRO ---\nBuscando la mejor coincidencia para'TEJA SENCILLA' en 0 opciones.\nNo se encontró una buena coincidencia para el suministro.\nEncontrados 0 candidatos para suministro.\nADVERTENCIA: No se encontró un APU de suministro directo. Iniciando fallback a insumos.\nERROR (Fallback): Material no encontrado en lista de insumos.\n\n--- BÚSQUEDA DE INSTALACIÓN ---\nPaso A: 0 APUs encontrados con 'MANO DE OBRA' e 'INSTALACION'.\nPaso B: 0APUs restantes tras filtrar por 'TEJA SENCILLA'.\nPaso C: 0 APUs restantes tras filtrar por 'CUADRILLA DE 5'.\nERROR: No se encontró un APU de instalación que coincida con todos los criterios."}

======================================================================
FAIL: test_calculate_estimate_with_fuzzywuzzy (__main__.TestCSVProcessor.test_calculate_estimate_with_fuzzywuzzy)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/gerardo/.local/share/uv/python/cpython-3.12.11-linux-x86_64-gnu/lib/python3.12/unittest/mock.py", line 1396, in patched
    return func(*newargs, **newkeywargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/gerardo/Documentos/GitHub/apu_filter/tests/test_app.py", line 348, in test_calculate_estimate_with_fuzzywuzzy
    self.assertNotIn("error", result)
AssertionError: 'error' unexpectedly found in {'error': 'No se encontró un APU de instalación que coincida con todos los criterios.', 'log': "Parámetros de entrada: {'tipo': 'CUBIERTA', 'material': 'TST', 'cuadrilla': '5'}\nParámetros mapeados: material='TEJA SENCILLA', tipo='INSTALACION'\n\n--- BÚSQUEDA DE SUMINISTRO ---\nBuscando la mejor coincidencia para'TEJA SENCILLA' en 0 opciones.\nNo se encontró una buena coincidencia para el suministro.\nEncontrados 0 candidatos para suministro.\nADVERTENCIA: No se encontró un APU de suministro directo. Iniciando fallback a insumos.\nERROR (Fallback): Material no encontrado en lista de insumos.\n\n--- BÚSQUEDA DE INSTALACIÓN ---\nPaso A: 0 APUs encontrados con 'MANO DE OBRA' e 'INSTALACION'.\nPaso B: 0APUs restantes tras filtrar por 'TEJA SENCILLA'.\nPaso C: 0 APUs restantes tras filtrar por 'CUADRILLA DE 5'.\nERROR: No se encontró un APU de instalación que coincida con todos los criterios."}

----------------------------------------------------------------------
Ran 15 tests in 3.927s

FAILED (failures=3)