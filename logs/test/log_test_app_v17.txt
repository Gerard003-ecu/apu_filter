.2025-09-16 09:39:42,065 - INFO - Cache miss.
2025-09-16 09:39:42,065 - INFO - Procesando archivos: test_uploads/c0534096-b69d-49f0-8c76-38af99daf17f/presupuesto_1758033582_presupuesto.csv, test_uploads/c0534096-b69d-49f0-8c76-38af99daf17f/apus_1758033582_apus.csv, test_uploads/c0534096-b69d-49f0-8c76-38af99daf17f/insumos_1758033582_insumos.csv
2025-09-16 09:39:42,073 - INFO - Éxito al leerpresupuesto_1758033582_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 09:39:42,084 - INFO - Tipos de datos optimizados con PyArrow para test_uploads/c0534096-b69d-49f0-8c76-38af99daf17f/presupuesto_1758033582_presupuesto.csv
2025-09-16 09:39:42,251 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 09:39:42,278 - INFO - --- Procesamiento completado ---
2025-09-16 09:39:42,351 - INFO - Cache info: hits=0, misses=1, size=1
.2025-09-16 09:39:42,364 - INFO - Cache miss.
2025-09-16 09:39:42,365 - INFO - Procesando archivos: test_uploads/e495f16b-d660-4b38-b642-de7f72146ca6/presupuesto_1758033582_presupuesto.csv, test_uploads/e495f16b-d660-4b38-b642-de7f72146ca6/apus_1758033582_apus.csv, test_uploads/e495f16b-d660-4b38-b642-de7f72146ca6/insumos_1758033582_insumos.csv
2025-09-16 09:39:42,372 - INFO - Éxito al leerpresupuesto_1758033582_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 09:39:42,376 - INFO - Tipos de datos optimizados con PyArrow para test_uploads/e495f16b-d660-4b38-b642-de7f72146ca6/presupuesto_1758033582_presupuesto.csv
2025-09-16 09:39:42,498 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 09:39:42,528 - INFO - --- Procesamiento completado ---
2025-09-16 09:39:42,604 - INFO - Cache info: hits=0, misses=2, size=2
/home/gerardo/Documentos/GitHub/apu_filter/app/procesador_csv.py:732: UserWarning: This pattern is interpreted as a regular expression, and has match groups. To actually get the groups, use str.extract.
  df_apus_unique["DESC_NORMALIZED"].str.contains(suministro_search_terms, regex=True)
.2025-09-16 09:39:42,698 - INFO - Cache miss.
2025-09-16 09:39:42,700 - INFO - Procesando archivos: test_uploads/6f9c2c68-0380-4fa2-b546-4cb4972610e4/presupuesto_1758033582_presupuesto.csv, test_uploads/6f9c2c68-0380-4fa2-b546-4cb4972610e4/apus_1758033582_apus.csv, test_uploads/6f9c2c68-0380-4fa2-b546-4cb4972610e4/insumos_1758033582_insumos.csv
2025-09-16 09:39:42,711 - INFO - Éxito al leerpresupuesto_1758033582_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 09:39:42,716 - INFO - Tipos de datos optimizados con PyArrow para test_uploads/6f9c2c68-0380-4fa2-b546-4cb4972610e4/presupuesto_1758033582_presupuesto.csv
2025-09-16 09:39:42,825 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 09:39:42,854 - INFO - --- Procesamiento completado ---
2025-09-16 09:39:42,903 - INFO - Cache info: hits=0, misses=3, size=3
.2025-09-16 09:39:42,960 - INFO - Cache miss.
2025-09-16 09:39:42,961 - INFO - Procesando archivos: test_presupuesto.csv, test_apus.csv, test_insumos.csv
2025-09-16 09:39:42,967 - INFO - Éxito al leertest_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 09:39:42,972 - INFO - Tipos de datos optimizados con PyArrow para test_presupuesto.csv
2025-09-16 09:39:43,073 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 09:39:43,100 - INFO - --- Procesamiento completado ---
2025-09-16 09:39:43,170 - INFO - Cache info: hits=0, misses=1, size=1
2025-09-16 09:39:43,171 - INFO - Cache info: hits=1, misses=1, size=1
2025-09-16 09:39:43,172 - INFO - Caché limpiado forzosamente y procesando sin caché.
2025-09-16 09:39:43,172 - INFO - Procesando archivos: test_presupuesto.csv, test_apus.csv, test_insumos.csv
2025-09-16 09:39:43,182 - INFO - Éxito al leertest_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 09:39:43,190 - INFO - Tipos de datos optimizados con PyArrow para test_presupuesto.csv
2025-09-16 09:39:43,312 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 09:39:43,346 - INFO - --- Procesamiento completado ---
.2025-09-16 09:39:43,406 - INFO - Cache miss.
2025-09-16 09:39:43,408 - INFO - Procesando archivos: test_presupuesto.csv, test_apus.csv, test_insumos.csv
2025-09-16 09:39:43,418 - INFO - Éxito al leertest_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 09:39:43,423 - INFO - Tipos de datos optimizados con PyArrow para test_presupuesto.csv
2025-09-16 09:39:43,551 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 09:39:43,630 - INFO - --- Procesamiento completado ---
2025-09-16 09:39:43,840 - INFO - Cache info: hits=0, misses=1, size=1
/home/gerardo/Documentos/GitHub/apu_filter/app/procesador_csv.py:732: UserWarning: This pattern is interpreted as a regular expression, and has match groups. To actually get the groups, use str.extract.
  df_apus_unique["DESC_NORMALIZED"].str.contains(suministro_search_terms, regex=True)
.2025-09-16 09:39:43,869 - INFO - Cache miss.
2025-09-16 09:39:43,871 - INFO - Procesando archivos: test_presupuesto_comma.csv, test_apus_comma.csv, test_insumos_comma.csv
2025-09-16 09:39:43,897 - INFO - Éxito al leertest_presupuesto_comma.csv con encoding 'latin1'y delimitador ','
2025-09-16 09:39:43,904 - INFO - Tipos de datos optimizados con PyArrow para test_presupuesto_comma.csv
2025-09-16 09:39:44,017 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 09:39:44,044 - INFO - --- Procesamiento completado ---
2025-09-16 09:39:44,086 - INFO - Cache info: hits=0, misses=1, size=1
.2025-09-16 09:39:44,091 - INFO - Cache miss.
2025-09-16 09:39:44,092 - INFO - Procesando archivos: test_presupuesto.csv, test_apus.csv, test_insumos.csv
2025-09-16 09:39:44,099 - INFO - Éxito al leertest_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 09:39:44,103 - INFO - Tipos de datos optimizados con PyArrow para test_presupuesto.csv
2025-09-16 09:39:44,223 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 09:39:44,347 - INFO - --- Procesamiento completado ---
2025-09-16 09:39:44,676 - INFO - Cache info: hits=0, misses=1, size=1
.2025-09-16 09:39:44,688 - INFO - Cache miss.
2025-09-16 09:39:44,690 - INFO - Procesando archivos: test_presupuesto.csv, test_malformed_apus.csv, test_insumos.csv
2025-09-16 09:39:44,741 - INFO - Éxito al leertest_presupuesto.csv con encoding 'latin1'y delimitador ';'
2025-09-16 09:39:44,771 - INFO - Tipos de datos optimizados con PyArrow para test_presupuesto.csv
2025-09-16 09:39:45,186 - INFO - Diagnóstico: 4 de 4 ítems del presupuesto encontraron su costo.
2025-09-16 09:39:45,210 - INFO - --- Procesamiento completado ---
2025-09-16 09:39:45,261 - INFO - Cache info: hits=0, misses=1, size=1
F...2025-09-16 09:39:45,299 - ERROR - No se pudo leer non_existent_file.csv con ninguna combinación.
2025-09-16 09:39:45,303 - INFO - Éxito al leertest_encoding.csv con encoding 'latin1'y delimitador ';'
2025-09-16 09:39:45,305 - INFO - Tipos de datos optimizados con PyArrow para test_encoding.csv
2025-09-16 09:39:45,825 - INFO - Éxito al leer Excel test.xlsx
2025-09-16 09:39:45,830 - INFO - Tipos de datos optimizados con PyArrow para test.xlsx
.
======================================================================
FAIL: test_process_apus_with_malformed_code (__main__.TestCSVProcessor.test_process_apus_with_malformed_code)
Prueba que un CODIGO_APU con comas o puntos extra al final se limpie correctamente.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/gerardo/.local/share/uv/python/cpython-3.12.11-linux-x86_64-gnu/lib/python3.12/unittest/mock.py", line 1396, in patched
    return func(*newargs, **newkeywargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/gerardo/Documentos/GitHub/apu_filter/tests/test_app.py", line 331, in test_process_apus_with_malformed_code