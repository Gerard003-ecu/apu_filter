============================================== short test summary info ===============================================
FAILED dev_tools/test_diagnose_grammar.py::TestBasicFunctionality::test_diagnose_all_valid_lines - AssertionError: assert 'Total l\xedneas analizadas: 5' in '========================================================================================================================\nDIAGN\xd3STICO DE INCOMPATIBILIDAD GRAM\xc1TICA-DATOS\n========================================================================================================================\n\nArchivo analizado: Desconocido\nCodificaci\xf3n usada: utf-8\nTotal l\xedneas en archivo: 5\nL\xedneas analizadas (sin encabezados): 5\nL\xedneas que fallan Lark: 0\nTasa de fallo: 0.00%\n\n\u2713 No se encontraron l\xedneas fallidas - la gram\xe1tica es compatible con todos los datos analizados.\n'
FAILED dev_tools/test_diagnose_grammar.py::TestBasicFunctionality::test_diagnose_mixed_valid_invalid - assert 'L\xedneas con campos vac\xedos:' in "========================================================================================================================\nDIAGN\xd3STICO DE INCOMPATIBILIDAD GRAM\xc1TICA-DATOS\n========================================================================================================================\n\nArchivo analizado: Desconocido\nCodificaci\xf3n usada: utf-8\nTotal l\xedneas en archivo: 7\nL\xedneas analizadas (sin encabezados): 7\nL\xedneas que fallan Lark: 6\nTasa de fallo: 85.71%\n\nAN\xc1LISIS ESTAD\xcdSTICO:\n------------------------------------------------------------\nTotal de l\xedneas fallidas: 6\nTipos de error:\n  - UnexpectedToken: 6 (100.0%)\nCampos vac\xedos totales: 15\nCampos con solo espacios: 0\nL\xedneas que terminan en ';': 2\nL\xedneas que comienzan con ';': 2\nDistribuci\xf3n de cantidad de campos:\n  - 5 campos: 6 l\xedneas\n\n\nMUESTRAS DE L\xcdNEAS FALLIDAS:\n------------------------------------------------------------------------------------------------------------------------\n\nL\xednea 2:\n  Error (UnexpectedToken): Unexpected token Token('SEMICOLON', ';') at line 1, column 14.\nExpected one of: \n\t* /[A-Z0-9.]+/\nPrevious tokens: [Token('SEMICOLON', ';')]\n\n  Campos: 5 | Longitud l\xednea: 31\n  Contenido: 'ARENA LAVADA;;2,000;45,00;90,00'\n  Campos (longitudes): [(0, 12), (1, 0), (2, 5), (3, 5), (4, 5)]\n  \u26a0\ufe0f  Campos completamente vac\xedos en posiciones: [1]\n\nL\xednea 3:\n  Error (UnexpectedToken): Unexpected token Token('SEMICOLON', ';') at line 1, column 7.\nExpected one of: \n\t* /[A-Z0-9.]+/\nPrevious tokens: [Token('SEMICOLON', ';')]\n\n  Campos: 5 | Longitud l\xednea: 19\n  Contenido: 'ACERO;;;1,89;161,12'\n  Campos (longitudes): [(0, 5), (1, 0), (2, 0), (3, 4), (4, 6)]\n  \u26a0\ufe0f  Campos completamente vac\xedos en posiciones: [1, 2]\n\nL\xednea 4:\n  Error (UnexpectedToken): Unexpected token Token('SEMICOLON', ';') at line 1, column 1.\nExpected one of: \n\t* /[^;]+/\nPrevious tokens: [None]\n\n  Campos: 5 | Longitud l\xednea: 9\n  Contenido: ';;;45,00;'\n  Campos (longitudes): [(0, 0), (1, 0), (2, 0), (3, 5), (4, 0)]\n  \u26a0\ufe0f  Campos completamente vac\xedos en posiciones: [0, 1, 2, 4]\n  \U0001f4a1 Caracter\xedsticas especiales: termina en ;, comienza con ;\n\nL\xednea 5:\n  Error (UnexpectedToken): Unexpected token Token('__ANON_0', 'abc') at line 1, column 14.\nExpected one of: \n\t* NUMBER\nPrevious tokens: [Token('SEMICOLON', ';')]\n\n  Campos: 5 | Longitud l\xednea: 29\n  Contenido: 'ENCOFRADO;M2;abc;15,75;196,88'\n  Campos (longitudes): [(0, 9), (1, 2), (2, 3), (3, 5), (4, 6)]\n\nL\xednea 6:\n  Error (UnexpectedToken): Unexpected token Token('SEMICOLON', ';') at line 1, column 10.\nExpected one of: \n\t* /[A-Z0-9.]+/\nPrevious tokens: [Token('SEMICOLON', ';')]\n\n  Campos: 5 | Longitud l\xednea: 19\n  Contenido: 'SUBTOTAL;;;;5000,00'\n  Campos (longitudes): [(0, 8), (1, 0), (2, 0), (3, 0), (4, 7)]\n  \u26a0\ufe0f  Campos completamente vac\xedos en posiciones: [1, 2, 3]\n\nL\xednea 7:\n  Error (UnexpectedToken): Unexpected token Token('SEMICOLON', ';') at line 1, column 1.\nExpected one of: \n\t* /[^;]+/\nPrevious tokens: [None]\n\n  Campos: 5 | Longitud l\xednea: 4\n  Contenido: ';;;;'\n  Campos (longitudes): [(0, 0), (1, 0), (2, 0), (3, 0), (4, 0)]\n  \u26a0\ufe0f  Campos completamente vac\xedos en posiciones: [0, 1, 2, 3, 4]\n  \U0001f4a1 Caracter\xedsticas especiales: termina en ;, comienza con ;\n"
FAILED dev_tools/test_diagnose_grammar.py::TestBasicFunctionality::test_skip_apu_headers - AssertionError: assert 'Total l\xedneas analizadas:' in '========================================================================================================================\nDIAGN\xd3STICO DE INCOMPATIBILIDAD GRAM\xc1TICA-DATOS\n========================================================================================================================\n\nArchivo analizado: Desconocido\nCodificaci\xf3n usada: utf-8\nTotal l\xedneas en archivo: 7\nL\xedneas analizadas (sin encabezados): 3\nL\xedneas que fallan Lark: 0\nTasa de fallo: 0.00%\n\n\u2713 No se encontraron l\xedneas fallidas - la gram\xe1tica es compatible con todos los datos analizados.\n'
FAILED dev_tools/test_diagnose_grammar.py::TestPatternAnalysis::test_detect_empty_fields - assert 'Campos vac\xedos en posiciones:' in "========================================================================================================================\nDIAGN\xd3STICO DE INCOMPATIBILIDAD GRAM\xc1TICA-DATOS\n========================================================================================================================\n\nArchivo analizado: Desconocido\nCodificaci\xf3n usada: utf-8\nTotal l\xedneas en archivo: 3\nL\xedneas analizadas (sin encabezados): 3\nL\xedneas que fallan Lark: 3\nTasa de fallo: 100.00%\n\nAN\xc1LISIS ESTAD\xcdSTICO:\n------------------------------------------------------------\nTotal de l\xedneas fallidas: 3\nTipos de error:\n  - UnexpectedToken: 3 (100.0%)\nCampos vac\xedos totales: 3\nCampos con solo espacios: 0\nL\xedneas que terminan en ';': 0\nL\xedneas que comienzan con ';': 0\nDistribuci\xf3n de cantidad de campos:\n  - 5 campos: 3 l\xedneas\n\n\nMUESTRAS DE L\xcdNEAS FALLIDAS:\n------------------------------------------------------------------------------------------------------------------------\n\nL\xednea 1:\n  Error (UnexpectedToken): Unexpected token Token('SEMICOLON', ';') at line 1, column 13.\nExpected one of: \n\t* /[A-Z0-9.]+/\nPrevious tokens: [Token('SEMICOLON', ';')]\n\n  Campos: 5 | Longitud l\xednea: 24\n  Contenido: 'DESCRIPCION;;123;456;789'\n  Campos (longitudes): [(0, 11), (1, 0), (2, 3), (3, 3), (4, 3)]\n  \u26a0\ufe0f  Campos completamente vac\xedos en posiciones: [1]\n\nL\xednea 2:\n  Error (UnexpectedToken): Unexpected token Token('SEMICOLON', ';') at line 1, column 17.\nExpected one of: \n\t* NUMBER\nPrevious tokens: [Token('SEMICOLON', ';')]\n\n  Campos: 5 | Longitud l\xednea: 24\n  Contenido: 'DESCRIPCION;UND;;456;789'\n  Campos (longitudes): [(0, 11), (1, 3), (2, 0), (3, 3), (4, 3)]\n  \u26a0\ufe0f  Campos completamente vac\xedos en posiciones: [2]\n\nL\xednea 3:\n  Error (UnexpectedToken): Unexpected token Token('SEMICOLON', ';') at line 1, column 21.\nExpected one of: \n\t* NUMBER\nPrevious tokens: [Token('SEMICOLON', ';')]\n\n  Campos: 5 | Longitud l\xednea: 24\n  Contenido: 'DESCRIPCION;UND;123;;789'\n  Campos (longitudes): [(0, 11), (1, 3), (2, 3), (3, 0), (4, 3)]\n  \u26a0\ufe0f  Campos completamente vac\xedos en posiciones: [3]\n"
FAILED dev_tools/test_diagnose_grammar.py::TestPatternAnalysis::test_failure_rate_calculation - assert 'Total l\xedneas analizadas: 5' in "========================================================================================================================\nDIAGN\xd3STICO DE INCOMPATIBILIDAD GRAM\xc1TICA-DATOS\n========================================================================================================================\n\nArchivo analizado: Desconocido\nCodificaci\xf3n usada: utf-8\nTotal l\xedneas en archivo: 5\nL\xedneas analizadas (sin encabezados): 5\nL\xedneas que fallan Lark: 3\nTasa de fallo: 60.00%\n\nAN\xc1LISIS ESTAD\xcdSTICO:\n------------------------------------------------------------\nTotal de l\xedneas fallidas: 3\nTipos de error:\n  - UnexpectedToken: 3 (100.0%)\nCampos vac\xedos totales: 9\nCampos con solo espacios: 0\nL\xedneas que terminan en ';': 2\nL\xedneas que comienzan con ';': 0\nDistribuci\xf3n de cantidad de campos:\n  - 4 campos: 1 l\xedneas\n  - 5 campos: 1 l\xedneas\n  - 7 campos: 1 l\xedneas\n\n\nMUESTRAS DE L\xcdNEAS FALLIDAS:\n------------------------------------------------------------------------------------------------------------------------\n\nL\xednea 3:\n  Error (UnexpectedToken): Unexpected token Token('SEMICOLON', ';') at line 1, column 10.\nExpected one of: \n\t* /[A-Z0-9.]+/\nPrevious tokens: [Token('SEMICOLON', ';')]\n\n  Campos: 4 | Longitud l\xednea: 11\n  Contenido: 'INVALIDA;;;'\n  Campos (longitudes): [(0, 8), (1, 0), (2, 0), (3, 0)]\n  \u26a0\ufe0f  Campos completamente vac\xedos en posiciones: [1, 2, 3]\n  \U0001f4a1 Caracter\xedsticas especiales: termina en ;\n\nL\xednea 4:\n  Error (UnexpectedToken): Unexpected token Token('__ANON_0', 'abc') at line 1, column 10.\nExpected one of: \n\t* /[A-Z0-9.]+/\nPrevious tokens: [Token('SEMICOLON', ';')]\n\n  Campos: 5 | Longitud l\xednea: 24\n  Contenido: 'INVALIDA;abc;def;ghi;jkl'\n  Campos (longitudes): [(0, 8), (1, 3), (2, 3), (3, 3), (4, 3)]\n\nL\xednea 5:\n  Error (UnexpectedToken): Unexpected token Token('SEMICOLON', ';') at line 1, column 10.\nExpected one of: \n\t* /[A-Z0-9.]+/\nPrevious tokens: [Token('SEMICOLON', ';')]\n\n  Campos: 7 | Longitud l\xednea: 14\n  Contenido: 'INVALIDA;;;;;;'\n  Campos (longitudes): [(0, 8), (1, 0), (2, 0), (3, 0), (4, 0), (5, 0), (6, 0)]\n  \u26a0\ufe0f  Campos completamente vac\xedos en posiciones: [1, 2, 3, 4, 5, 6]\n  \U0001f4a1 Caracter\xedsticas especiales: termina en ;\n"
FAILED dev_tools/test_diagnose_grammar.py::TestErrorHandling::test_empty_csv_file - AssertionError: assert 'Total l\xedneas analizadas: 0' in '========================================================================================================================\nDIAGN\xd3STICO DE INCOMPATIBILIDAD GRAM\xc1TICA-DATOS\n========================================================================================================================\n\nArchivo analizado: Desconocido\nCodificaci\xf3n usada: utf-8\nTotal l\xedneas en archivo: 0\nL\xedneas analizadas (sin encabezados): 0\nL\xedneas que fallan Lark: 0\nTasa de fallo: 0% (no se analizaron l\xedneas)\n\n\u2713 No se encontraron l\xedneas fallidas - la gram\xe1tica es compatible con todos los datos analizados.\n'
FAILED dev_tools/test_diagnose_grammar.py::TestOutputFormat::test_output_file_structure - AssertionError: assert 'Total l\xedneas analizadas:' in '========================================================================================================================\nDIAGN\xd3STICO DE INCOMPATIBILIDAD GRAM\xc1TICA-DATOS\n========================================================================================================================\n\nArchivo analizado: Desconocido\nCodificaci\xf3n usada: utf-8\nTotal l\xedneas en archivo: 5\nL\xedneas analizadas (sin encabezados): 5\nL\xedneas que fallan Lark: 0\nTasa de fallo: 0.00%\n\n\u2713 No se encontraron l\xedneas fallidas - la gram\xe1tica es compatible con todos los datos analizados.\n'
FAILED dev_tools/test_diagnose_grammar.py::TestOutputFormat::test_output_detailed_error_info - assert 'Error:' in "========================================================================================================================\nDIAGN\xd3STICO DE INCOMPATIBILIDAD GRAM\xc1TICA-DATOS\n========================================================================================================================\n\nArchivo analizado: Desconocido\nCodificaci\xf3n usada: utf-8\nTotal l\xedneas en archivo: 1\nL\xedneas analizadas (sin encabezados): 1\nL\xedneas que fallan Lark: 1\nTasa de fallo: 100.00%\n\nAN\xc1LISIS ESTAD\xcdSTICO:\n------------------------------------------------------------\nTotal de l\xedneas fallidas: 1\nTipos de error:\n  - UnexpectedToken: 1 (100.0%)\nCampos vac\xedos totales: 1\nCampos con solo espacios: 0\nL\xedneas que terminan en ';': 0\nL\xedneas que comienzan con ';': 0\nDistribuci\xf3n de cantidad de campos:\n  - 5 campos: 1 l\xedneas\n\n\nMUESTRAS DE L\xcdNEAS FALLIDAS:\n------------------------------------------------------------------------------------------------------------------------\n\nL\xednea 1:\n  Error (UnexpectedToken): Unexpected token Token('SEMICOLON', ';') at line 1, column 10.\nExpected one of: \n\t* /[A-Z0-9.]+/\nPrevious tokens: [Token('SEMICOLON', ';')]\n\n  Campos: 5 | Longitud l\xednea: 21\n  Contenido: 'INVALIDA;;123;456;789'\n  Campos (longitudes): [(0, 8), (1, 0), (2, 3), (3, 3), (4, 3)]\n  \u26a0\ufe0f  Campos completamente vac\xedos en posiciones: [1]\n"
FAILED tests/test_generate_embeddings.py::test_pipeline_run_integration - TypeError: isinstance() arg 2 must be a type, a tuple of types, or a union
FAILED tests/test_generate_embeddings.py::test_pipeline_with_mocked_write - TypeError: index debe ser una instancia de faiss.Index
FAILED tests/test_topological_analyzer.py::TestSystemTopologyCyclesAndAnomalies::test_get_unexpected_connections - assert 0 >= 1
 +  where 0 = len(frozenset())
FAILED tests/test_topological_analyzer.py::TestSystemTopologyHealth::test_healthy_topology - AssertionError: assert <HealthLevel.DEGRADED: 2> == <HealthLevel.HEALTHY: 1>
 +  where <HealthLevel.DEGRADED: 2> = TopologicalHealth(betti=BettiNumbers(b0=1, b1=0, num_vertices=4, num_edges=3), disconnected_nodes=frozenset(), missing_edges=frozenset({('Agent', 'Redis'), ('Agent', 'Filesystem')}), request_loops=(), health_score=0.76, level=<HealthLevel.DEGRADED: 2>, diagnostics={'missing_edges': 'Conexiones faltantes: Agent-Redis, Agent-Filesystem (-0.24)'}).level
 +  and   <HealthLevel.HEALTHY: 1> = HealthLevel.HEALTHY
FAILED tests/test_topological_analyzer.py::TestIntegration::test_topology_and_persistence_workflow - AssertionError: assert False
 +  where False = TopologicalHealth(betti=BettiNumbers(b0=1, b1=0, num_vertices=4, num_edges=3), disconnected_nodes=frozenset(), missing_edges=frozenset({('Agent', 'Redis'), ('Agent', 'Filesystem')}), request_loops=(), health_score=0.76, level=<HealthLevel.DEGRADED: 2>, diagnostics={'missing_edges': 'Conexiones faltantes: Agent-Redis, Agent-Filesystem (-0.24)'}).is_healthy
=================================== 13 failed, 1235 passed, 82 warnings in 57.23s ====================================