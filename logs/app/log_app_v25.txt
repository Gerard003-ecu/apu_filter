18:45:30 - INFO - Iniciando aplicaci√≥n en modo: development
18:45:30 - INFO - Iniciando aplicaci√≥n en modo: development
18:45:30 - INFO - Configuraci√≥n cargada exitosamente desde config.json
18:45:30 - INFO - Configuraci√≥n cargada exitosamente desde config.json
18:45:30 - INFO - APUPresenter inicializado correctamente
18:45:30 - INFO - APUPresenter inicializado correctamente
18:45:30 - INFO - Iniciando carga de artefactos de b√∫squeda sem√°ntica...
18:45:30 - INFO - Iniciando carga de artefactos de b√∫squeda sem√°ntica...
18:45:30 - WARNING - No se encontraron todos los archivos de embeddings. La b√∫squeda sem√°ntica estar√° desactivada. Ejecute 'scripts/generate_embeddings.py' para generarlos.
18:45:30 - WARNING - No se encontraron todos los archivos de embeddings. La b√∫squeda sem√°ntica estar√° desactivada. Ejecute 'scripts/generate_embeddings.py' para generarlos.
 * Serving Flask app 'app.app:create_app('development')'
 * Debug mode: off
18:45:30 - INFO - WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on http://127.0.0.1:5002
18:45:30 - INFO - Press CTRL+C to quit
18:46:27 - INFO - 127.0.0.1 - - [16/Nov/2025 18:46:27] "GET / HTTP/1.1" 200 -
18:46:52 - INFO - Procesando archivos para sesi√≥n Su8Y-bH2...
18:46:52 - INFO - Procesando archivos para sesi√≥n Su8Y-bH2...
18:46:52 - INFO - ================================================================================
18:46:52 - INFO - üöÄ Iniciando procesamiento de archivos con patr√≥n pipeline...
18:46:52 - INFO - ================================================================================
18:46:52 - INFO - üîÑ Ejecutando pipeline de procesamiento...
18:46:52 - INFO - üì• Cargando presupuesto con perfil: {'header': 0, 'sep': ';', 'encoding': 'UTF-8-SIG'}
18:46:52 - INFO - Cargando datos desde /home/gerardo/Documentos/GitHub/apu_filter/uploads/Su8Y-bH2A7CRxl09loHF6cczm3oG1IusW0-knZgA_2U/presupuesto_clean.csv (formato: .csv)
18:46:52 - INFO - Cargando CSV desde /home/gerardo/Documentos/GitHub/apu_filter/uploads/Su8Y-bH2A7CRxl09loHF6cczm3oG1IusW0-knZgA_2U/presupuesto_clean.csv con delimitador ';' y codificaci√≥n 'UTF-8-SIG'
18:46:52 - INFO - üìä DataFrame inicial: 436 filas, 6 columnas
18:46:52 - INFO - üßπ  Limpieza de filas fantasma: 436 ‚Üí 435 filas (-1 eliminadas)
18:46:52 - INFO - üßπ Limpieza de filas fantasma: 436 ‚Üí 435 filas
18:46:52 - INFO - ‚úÖ Columnas renombradas: ['CODIGO_APU', 'DESCRIPCION_APU', 'UND', 'CANTIDAD_PRESUPUESTO', ' VR. UNIT ', ' VR.TOTAL']
18:46:52 - INFO - üîß Iniciando limpieza de 435 registros...
18:46:52 - WARNING - C√≥digo APU sin n√∫meros (inusual): 'nan' -> 'NAN'
18:46:52 - WARNING - ‚ö†Ô∏è  94 registros con cantidad = 0
18:46:52 - INFO - ‚úÖ Limpieza completada: 435 registros v√°lidos (0 eliminados, 100.0% conservado)
18:46:52 - WARNING - ‚ö†Ô∏è  Se encontraron 339 filas duplicadas en 'presupuesto' por ['CODIGO_APU']. Se conservar√°: 'first'
18:46:52 - INFO - ‚úÖ Duplicados eliminados: 435 -> 105 filas
18:46:52 - INFO - üîÑ Duplicados eliminados: 330 (105 √∫nicos de 435 totales)
18:46:52 - INFO - ‚úÖ Presupuesto cargado: 105 APUs √∫nicos
18:46:52 - WARNING - ‚ö†Ô∏è  Se encontraron 54 insumos con descripciones normalizadas duplicadas. Se conservar√° el de mayor precio.
18:46:52 - INFO - ‚úÖ Insumos cargados: 115 insumos √∫nicos
18:46:52 - INFO - Iniciando parseo l√≠nea por l√≠nea de: apus_clean.csv
18:46:52 - INFO - Archivo le√≠do exitosamente con codificaci√≥n: utf-8
18:46:52 - INFO - Parseo completo. Extra√≠dos 981 registros crudos.
18:46:52 - INFO - Parser Lark inicializado con arquitectura de especialistas
18:46:52 - INFO - Iniciando procesamiento de 981 APUs con especialistas
18:46:52 - INFO - Procesados 100/981 APUs
18:46:52 - INFO - Procesados 200/981 APUs
18:46:52 - INFO - Procesados 300/981 APUs
18:46:52 - INFO - Procesados 400/981 APUs
18:46:52 - INFO - Procesados 500/981 APUs
18:46:52 - INFO - Procesados 600/981 APUs
18:46:52 - INFO - Procesados 700/981 APUs
18:46:52 - INFO - Procesados 800/981 APUs
18:46:52 - INFO - Procesados 900/981 APUs
18:46:52 - INFO - Procesamiento completado: 0 insumos extra√≠dos
18:46:52 - WARNING - No se encontraron insumos v√°lidos
18:46:52 - ERROR - ‚ùå DataFrame 'APUs' est√° vac√≠o o es None
18:46:52 - ERROR - ‚ùå Error en el pipeline: DataFrame 'APUs' est√° vac√≠o o es None
Traceback (most recent call last):
  File "/home/gerardo/Documentos/GitHub/apu_filter/app/procesador_csv.py", line 1479, in _do_processing
    final_context = pipeline.run(initial_context)
  File "/home/gerardo/Documentos/GitHub/apu_filter/app/procesador_csv.py", line 112, in run
    context = step.execute(context)
  File "/home/gerardo/Documentos/GitHub/apu_filter/app/procesador_csv.py", line 308, in execute
    raise ValueError(error)
ValueError: DataFrame 'APUs' est√° vac√≠o o es None
18:46:52 - INFO - ================================================================================
18:46:52 - INFO - üîç Ejecutando diagn√≥stico del archivo de APUs...
18:46:52 - INFO - ================================================================================
18:46:52 - INFO - üîç Iniciando diagn√≥stico: /home/gerardo/Documentos/GitHub/apu_filter/uploads/Su8Y-bH2A7CRxl09loHF6cczm3oG1IusW0-knZgA_2U/apus_clean.csv
18:46:52 - INFO - üì¶ Tama√±o: 139,423 bytes
18:46:53 - INFO - ‚úÖ Encoding detectado: utf-8 (confianza: 99.0%)
18:46:53 - INFO - ‚úÖ Dialecto CSV detectado:
   - Delimitador: ';'
   - Quote char: '"'
   - Double quote: False
18:46:53 - INFO - üìä An√°lisis de columnas:
   - Columnas m√°s com√∫n: 6
   - Distribuci√≥n: {6: 500}
   - Varianza: 0.00
18:46:53 - INFO - 
================================================================================
18:46:53 - INFO - üìä REPORTE DE DIAGN√ìSTICO AVANZADO - ARCHIVO APU
18:46:53 - INFO - ================================================================================
18:46:53 - INFO - 
üîç DETECCI√ìN AUTOM√ÅTICA DE FORMATO:
18:46:53 - INFO -   Encoding: utf-8 (confianza: 99.0%)
18:46:53 - INFO -   Delimitador CSV: ';'
18:46:53 - INFO -   Quote char: '"'
18:46:53 - INFO - 
üìà ESTAD√çSTICAS GENERALES:
18:46:53 - INFO -   Tama√±o: 139,423 bytes
18:46:53 - INFO -   Total l√≠neas: 3,027
18:46:53 - INFO -   L√≠neas vac√≠as: 0
18:46:53 - INFO -   L√≠neas con contenido: 3,027
18:46:53 - INFO - 
üìä AN√ÅLISIS DE COLUMNAS:
18:46:53 - INFO -   N√∫mero m√°s com√∫n: 6
18:46:53 - INFO -   Distribuci√≥n: {6: 500}
18:46:53 - INFO -   Varianza: 0.00
18:46:53 - INFO -   ‚úÖ Estructura regular
18:46:53 - INFO - 
üèóÔ∏è ESTRUCTURA:
18:46:53 - INFO -   Bloques (l√≠neas vac√≠as): 1
18:46:53 - INFO -   Bloques (guiones): 1
18:46:53 - INFO -   Bloques (iguales): 1
18:46:53 - INFO - 
üîë PALABRAS CLAVE:
18:46:53 - INFO -   'ITEM': 77 l√≠neas
18:46:53 - INFO -   'UNIDAD': 155 l√≠neas
18:46:53 - INFO -   'DESCRIPCION': 156 l√≠neas
18:46:53 - INFO -   Filas num√©ricas: 0
18:46:53 - INFO - 
üì¶ CATEGOR√çAS:
18:46:53 - INFO -   EQUIPO: 407 veces
18:46:53 - INFO -   MANO DE OBRA: 338 veces
18:46:53 - INFO -   MATERIALES: 312 veces
18:46:53 - INFO -   OTROS: 273 veces
18:46:53 - INFO - 
üéØ C√ìDIGOS ITEM (6 encontrados):
18:46:53 - INFO -   L√≠nea 2: 1,1
18:46:53 - INFO -   L√≠nea 20: 1,2
18:46:53 - INFO -   L√≠nea 38: 1,3
18:46:53 - INFO -   L√≠nea 56: 1,4
18:46:53 - INFO -   L√≠nea 74: 1,5
18:46:53 - INFO - 
üìù MUESTRA DE L√çNEAS:
18:46:53 - INFO -   L   1 ( 73 chars): REMATE CON PINTURA DE FABRICA CAL 22 DE 120 CMTS CURVO;;;;;  UNIDAD:   ML
18:46:53 - INFO -   L   2 ( 18 chars): ;;;;;  ITEM:   1,1
18:46:53 - INFO -   L   3 ( 58 chars): DESCRIPCION;UND;CANT.;DESP.%;  PRECIO UNIT  ;  VALOR TOTAL
18:46:53 - INFO -   L   4 ( 15 chars): MATERIALES;;;;;
18:46:53 - INFO -   L   5 ( 90 chars): LAMINA DE 1.22 X 3.05 MTS CAL. 22 PINTADA INCLUIDO IVA;UND;0,33;14,04;174.928,81;65.403,35
18:46:53 - INFO -   L   6 ( 37 chars): ;;;;  SUBTOTAL MATERIALES  ;65.403,35
18:46:53 - INFO -   L   7 ( 17 chars): MANO DE OBRA;;;;;
18:46:53 - INFO -   L   8 ( 48 chars): M.O. CORTE Y DOBLEZ;UND;6,316;;1.208,12;7.630,23
18:46:53 - INFO -   L   9 ( 39 chars): ;;;;  SUBTOTAL- MANO DE OBRA  ;7.630,23
18:46:53 - INFO -   L  10 ( 11 chars): EQUIPO;;;;;
18:46:53 - INFO - 
üí° RECOMENDACIONES:
18:46:53 - INFO -   ‚úÖ Usar pandas.read_csv() con:
18:46:53 - INFO -      sep=';', encoding='utf-8'
18:46:53 - INFO -   ‚úÖ Detectados 6 c√≥digos ITEM. Probablemente 'ITEM' marca inicio de cada APU.
18:46:53 - INFO - ================================================================================

18:46:53 - INFO - ================================================================================
18:46:53 - ERROR - Error de procesamiento: Error en el pipeline: DataFrame 'APUs' est√° vac√≠o o es None
18:46:53 - ERROR - Error de procesamiento: Error en el pipeline: DataFrame 'APUs' est√° vac√≠o o es None
18:46:53 - INFO - 127.0.0.1 - - [16/Nov/2025 18:46:53] "POST /upload HTTP/1.1" 500 -