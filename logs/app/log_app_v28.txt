(apu_filter_env) gerardomayor@MacBook-Air-de-Gerardo apu_filter % python -m flask run --port=5002
14:44:56 - INFO - Iniciando aplicaci√≥n en modo: development
14:44:56 - INFO - Iniciando aplicaci√≥n en modo: development
14:44:58 - INFO - Configuraci√≥n cargada exitosamente desde config.json
14:44:58 - INFO - Configuraci√≥n cargada exitosamente desde config.json
14:44:58 - INFO - APUPresenter inicializado correctamente
14:44:58 - INFO - APUPresenter inicializado correctamente
14:44:58 - INFO - Iniciando carga de artefactos de b√∫squeda sem√°ntica...
14:44:58 - INFO - Iniciando carga de artefactos de b√∫squeda sem√°ntica...
14:44:58 - WARNING - No se encontraron todos los archivos de embeddings. La b√∫squeda sem√°ntica estar√° desactivada. Ejecute 'scripts/generate_embeddings.py' para generarlos.
14:44:58 - WARNING - No se encontraron todos los archivos de embeddings. La b√∫squeda sem√°ntica estar√° desactivada. Ejecute 'scripts/generate_embeddings.py' para generarlos.
 * Serving Flask app 'app.app:create_app('development')'
 * Debug mode: off
14:44:58 - INFO - WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on http://127.0.0.1:5002
14:44:58 - INFO - Press CTRL+C to quit
14:45:23 - INFO - 127.0.0.1 - - [17/Nov/2025 14:45:23] "GET / HTTP/1.1" 200 -
14:45:24 - INFO - 127.0.0.1 - - [17/Nov/2025 14:45:24] "GET /favicon.ico HTTP/1.1" 404 -
14:46:28 - INFO - Procesando archivos para sesi√≥n J7L6Z523...
14:46:28 - INFO - Procesando archivos para sesi√≥n J7L6Z523...
14:46:28 - INFO - ================================================================================
14:46:28 - INFO - üöÄ Iniciando procesamiento de archivos con patr√≥n pipeline...
14:46:28 - INFO - ================================================================================
14:46:28 - INFO - üîÑ Ejecutando pipeline de procesamiento...
14:46:28 - INFO - üì• Cargando presupuesto con perfil: {'header': 0, 'sep': ';', 'encoding': 'UTF-8-SIG'}
14:46:28 - INFO - Cargando datos desde /Users/gerardomayor/Documents/estru_techos/apu_filter/uploads/J7L6Z523sE44CFpTDzpTERGrp-_i1zJ4yGnUcuNCvbc/presupuesto_clean.csv (formato: .csv)
14:46:28 - INFO - Cargando CSV desde /Users/gerardomayor/Documents/estru_techos/apu_filter/uploads/J7L6Z523sE44CFpTDzpTERGrp-_i1zJ4yGnUcuNCvbc/presupuesto_clean.csv con delimitador ';' y codificaci√≥n 'UTF-8-SIG'
14:46:28 - INFO - üìä DataFrame inicial: 436 filas, 6 columnas
14:46:29 - INFO - üßπ  Limpieza de filas fantasma: 436 ‚Üí 435 filas (-1 eliminadas)
14:46:29 - INFO - üßπ Limpieza de filas fantasma: 436 ‚Üí 435 filas
14:46:29 - INFO - ‚úÖ Columnas renombradas: ['CODIGO_APU', 'DESCRIPCION_APU', 'UND', 'CANTIDAD_PRESUPUESTO', ' VR. UNIT ', ' VR.TOTAL']
14:46:29 - INFO - üîß Iniciando limpieza de 435 registros...
14:46:29 - WARNING - C√≥digo APU sin n√∫meros (inusual): 'nan' -> 'NAN'
14:46:29 - WARNING - ‚ö†Ô∏è  94 registros con cantidad = 0
14:46:29 - INFO - ‚úÖ Limpieza completada: 435 registros v√°lidos (0 eliminados, 100.0% conservado)
14:46:29 - WARNING - ‚ö†Ô∏è  Se encontraron 339 filas duplicadas en 'presupuesto' por ['CODIGO_APU']. Se conservar√°: 'first'
14:46:29 - INFO - ‚úÖ Duplicados eliminados: 435 -> 105 filas
14:46:29 - INFO - üîÑ Duplicados eliminados: 330 (105 √∫nicos de 435 totales)
14:46:29 - INFO - ‚úÖ Presupuesto cargado: 105 APUs √∫nicos
14:46:29 - WARNING - ‚ö†Ô∏è  Se encontraron 54 insumos con descripciones normalizadas duplicadas. Se conservar√° el de mayor precio.
14:46:29 - INFO - ‚úÖ Insumos cargados: 115 insumos √∫nicos
14:46:29 - INFO - Iniciando parseo l√≠nea por l√≠nea de: apus_clean.csv
14:46:29 - INFO - Archivo le√≠do exitosamente con codificaci√≥n: utf-8
14:46:29 - INFO - ======================================================================
14:46:29 - INFO - üìä RESUMEN DE VALIDACI√ìN DE L√çNEAS
14:46:29 - INFO - ======================================================================
14:46:29 - INFO - Total l√≠neas evaluadas:        983
14:46:29 - INFO - ‚úì Insumos v√°lidos:             808 (82.2%)
14:46:29 - INFO - ‚úó Rechazados - Campos insuf.:  0
14:46:29 - INFO - ‚úó Rechazados - Sin num√©ricos:  173
14:46:29 - INFO - ‚úó Rechazados - Desc. vac√≠a:    2
14:46:29 - INFO - ‚úó Rechazados - Subtotales:     0
14:46:29 - INFO - ======================================================================
14:46:29 - INFO - Parseo completo. Extra√≠dos 808 registros crudos.
14:46:29 - INFO - Parser Lark inicializado con arquitectura de especialistas
14:46:29 - INFO - Iniciando procesamiento de 808 APUs con especialistas
14:46:29 - INFO - Procesados 100/808 APUs
14:46:29 - INFO - Procesados 200/808 APUs
14:46:29 - INFO - Procesados 300/808 APUs
14:46:29 - INFO - Procesados 400/808 APUs
14:46:29 - INFO - Procesados 500/808 APUs
14:46:29 - INFO - Procesados 600/808 APUs
14:46:29 - INFO - Procesados 700/808 APUs
14:46:29 - INFO - Procesados 800/808 APUs
14:46:29 - INFO - Procesamiento completado: 0 insumos extra√≠dos
14:46:29 - WARNING - No se encontraron insumos v√°lidos
14:46:29 - ERROR - ‚ùå DataFrame 'APUs' est√° vac√≠o o es None
14:46:29 - ERROR - ‚ùå Error en el pipeline: DataFrame 'APUs' est√° vac√≠o o es None
Traceback (most recent call last):
  File "/Users/gerardomayor/Documents/estru_techos/apu_filter/app/procesador_csv.py", line 1480, in _do_processing
    final_context = pipeline.run(initial_context)
  File "/Users/gerardomayor/Documents/estru_techos/apu_filter/app/procesador_csv.py", line 112, in run
    context = step.execute(context)
  File "/Users/gerardomayor/Documents/estru_techos/apu_filter/app/procesador_csv.py", line 309, in execute
    raise ValueError(error)
ValueError: DataFrame 'APUs' est√° vac√≠o o es None
14:46:29 - INFO - ================================================================================
14:46:29 - INFO - üîç Ejecutando diagn√≥stico del archivo de APUs...
14:46:29 - INFO - ================================================================================
14:46:29 - INFO - üîç Iniciando diagn√≥stico: /Users/gerardomayor/Documents/estru_techos/apu_filter/uploads/J7L6Z523sE44CFpTDzpTERGrp-_i1zJ4yGnUcuNCvbc/apus_clean.csv
14:46:29 - INFO - üì¶ Tama√±o: 139,423 bytes
14:46:30 - INFO - ‚úÖ Encoding detectado: utf-8 (confianza: 99.0%)
14:46:30 - INFO - ‚úÖ Dialecto CSV detectado:
   - Delimitador: ';'
   - Quote char: '"'
   - Double quote: False
14:46:30 - INFO - üìä An√°lisis de columnas:
   - Columnas m√°s com√∫n: 6
   - Distribuci√≥n: {6: 500}
   - Varianza: 0.00
14:46:30 - INFO - 
================================================================================
14:46:30 - INFO - üìä REPORTE DE DIAGN√ìSTICO AVANZADO - ARCHIVO APU
14:46:30 - INFO - ================================================================================
14:46:30 - INFO - 
üîç DETECCI√ìN AUTOM√ÅTICA DE FORMATO:
14:46:30 - INFO -   Encoding: utf-8 (confianza: 99.0%)
14:46:30 - INFO -   Delimitador CSV: ';'
14:46:30 - INFO -   Quote char: '"'
14:46:30 - INFO - 
üìà ESTAD√çSTICAS GENERALES:
14:46:30 - INFO -   Tama√±o: 139,423 bytes
14:46:30 - INFO -   Total l√≠neas: 3,027
14:46:30 - INFO -   L√≠neas vac√≠as: 0
14:46:30 - INFO -   L√≠neas con contenido: 3,027
14:46:30 - INFO - 
üìä AN√ÅLISIS DE COLUMNAS:
14:46:30 - INFO -   N√∫mero m√°s com√∫n: 6
14:46:30 - INFO -   Distribuci√≥n: {6: 500}
14:46:30 - INFO -   Varianza: 0.00
14:46:30 - INFO -   ‚úÖ Estructura regular
14:46:30 - INFO - 
üèóÔ∏è ESTRUCTURA:
14:46:30 - INFO -   Bloques (l√≠neas vac√≠as): 1
14:46:30 - INFO -   Bloques (guiones): 1
14:46:30 - INFO -   Bloques (iguales): 1
14:46:30 - INFO - 
üîë PALABRAS CLAVE:
14:46:30 - INFO -   'ITEM': 77 l√≠neas
14:46:30 - INFO -   'UNIDAD': 155 l√≠neas
14:46:30 - INFO -   'DESCRIPCION': 156 l√≠neas
14:46:30 - INFO -   Filas num√©ricas: 0
14:46:30 - INFO - 
üì¶ CATEGOR√çAS:
14:46:30 - INFO -   EQUIPO: 407 veces
14:46:30 - INFO -   MANO DE OBRA: 338 veces
14:46:30 - INFO -   MATERIALES: 312 veces
14:46:30 - INFO -   OTROS: 273 veces
14:46:30 - INFO - 
üéØ C√ìDIGOS ITEM (6 encontrados):
14:46:30 - INFO -   L√≠nea 2: 1,1
14:46:30 - INFO -   L√≠nea 20: 1,2
14:46:30 - INFO -   L√≠nea 38: 1,3
14:46:30 - INFO -   L√≠nea 56: 1,4
14:46:30 - INFO -   L√≠nea 74: 1,5
14:46:30 - INFO - 
üìù MUESTRA DE L√çNEAS:
14:46:30 - INFO -   L   1 ( 73 chars): REMATE CON PINTURA DE FABRICA CAL 22 DE 120 CMTS CURVO;;;;;  UNIDAD:   ML
14:46:30 - INFO -   L   2 ( 18 chars): ;;;;;  ITEM:   1,1
14:46:30 - INFO -   L   3 ( 58 chars): DESCRIPCION;UND;CANT.;DESP.%;  PRECIO UNIT  ;  VALOR TOTAL
14:46:30 - INFO -   L   4 ( 15 chars): MATERIALES;;;;;
14:46:30 - INFO -   L   5 ( 90 chars): LAMINA DE 1.22 X 3.05 MTS CAL. 22 PINTADA INCLUIDO IVA;UND;0,33;14,04;174.928,81;65.403,35
14:46:30 - INFO -   L   6 ( 37 chars): ;;;;  SUBTOTAL MATERIALES  ;65.403,35
14:46:30 - INFO -   L   7 ( 17 chars): MANO DE OBRA;;;;;
14:46:30 - INFO -   L   8 ( 48 chars): M.O. CORTE Y DOBLEZ;UND;6,316;;1.208,12;7.630,23
14:46:30 - INFO -   L   9 ( 39 chars): ;;;;  SUBTOTAL- MANO DE OBRA  ;7.630,23
14:46:30 - INFO -   L  10 ( 11 chars): EQUIPO;;;;;
14:46:30 - INFO - 
üí° RECOMENDACIONES:
14:46:30 - INFO -   ‚úÖ Usar pandas.read_csv() con:
14:46:30 - INFO -      sep=';', encoding='utf-8'
14:46:30 - INFO -   ‚úÖ Detectados 6 c√≥digos ITEM. Probablemente 'ITEM' marca inicio de cada APU.
14:46:30 - INFO - ================================================================================

14:46:30 - INFO - ================================================================================
14:46:30 - ERROR - Error de procesamiento: Error en el pipeline: DataFrame 'APUs' est√° vac√≠o o es None
14:46:30 - ERROR - Error de procesamiento: Error en el pipeline: DataFrame 'APUs' est√° vac√≠o o es None
14:46:30 - INFO - 127.0.0.1 - - [17/Nov/2025 14:46:30] "POST /upload HTTP/1.1" 500 -