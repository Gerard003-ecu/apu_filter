16:49:44 - INFO - Iniciando aplicaci√≥n en modo: development
16:49:44 - INFO - Iniciando aplicaci√≥n en modo: development
16:49:44 - INFO - Configuraci√≥n cargada exitosamente desde config.json
16:49:44 - INFO - Configuraci√≥n cargada exitosamente desde config.json
16:49:44 - INFO - APUPresenter inicializado correctamente
16:49:44 - INFO - APUPresenter inicializado correctamente
16:49:44 - INFO - Iniciando carga de artefactos de b√∫squeda sem√°ntica...
16:49:44 - INFO - Iniciando carga de artefactos de b√∫squeda sem√°ntica...
16:49:44 - WARNING - No se encontraron todos los archivos de embeddings. La b√∫squeda sem√°ntica estar√° desactivada. Ejecute 'scripts/generate_embeddings.py' para generarlos.
16:49:44 - WARNING - No se encontraron todos los archivos de embeddings. La b√∫squeda sem√°ntica estar√° desactivada. Ejecute 'scripts/generate_embeddings.py' para generarlos.
 * Serving Flask app 'app.app:create_app('development')'
 * Debug mode: off
16:49:44 - INFO - WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on http://127.0.0.1:5002
16:49:44 - INFO - Press CTRL+C to quit
16:49:47 - INFO - 127.0.0.1 - - [16/Nov/2025 16:49:47] "GET / HTTP/1.1" 200 -
16:50:00 - INFO - Procesando archivos para sesi√≥n UtpbeUyt...
16:50:00 - INFO - Procesando archivos para sesi√≥n UtpbeUyt...
16:50:00 - INFO - ================================================================================
16:50:00 - INFO - üöÄ Iniciando procesamiento de archivos con patr√≥n pipeline...
16:50:00 - INFO - ================================================================================
16:50:00 - INFO - üîÑ Ejecutando pipeline de procesamiento...
16:50:00 - INFO - üì• Cargando presupuesto con perfil: {'header': 0, 'sep': ';', 'encoding': 'UTF-8-SIG'}
16:50:00 - INFO - Cargando datos desde /home/gerardo/Documentos/GitHub/apu_filter/uploads/UtpbeUytXe1dhnqDYocehVor9ilNTKuRyBECChzb6v0/presupuesto_clean.csv (formato: .csv)
16:50:00 - INFO - Cargando CSV desde /home/gerardo/Documentos/GitHub/apu_filter/uploads/UtpbeUytXe1dhnqDYocehVor9ilNTKuRyBECChzb6v0/presupuesto_clean.csv con delimitador ';' y codificaci√≥n 'UTF-8-SIG'
16:50:00 - INFO - üìä DataFrame inicial: 436 filas, 6 columnas
16:50:00 - INFO - üßπ  Limpieza de filas fantasma: 436 ‚Üí 435 filas (-1 eliminadas)
16:50:00 - INFO - üßπ Limpieza de filas fantasma: 436 ‚Üí 435 filas
16:50:00 - INFO - ‚úÖ Columnas renombradas: ['CODIGO_APU', 'DESCRIPCION_APU', 'UND', 'CANTIDAD_PRESUPUESTO', ' VR. UNIT ', ' VR.TOTAL']
16:50:00 - INFO - üîß Iniciando limpieza de 435 registros...
16:50:00 - ERROR - ‚ùå Error fatal procesando presupuesto: clean_apu_code() got an unexpected keyword argument 'max_length'
Traceback (most recent call last):
  File "/home/gerardo/Documentos/GitHub/apu_filter/app/procesador_csv.py", line 436, in process
    df_converted = self._clean_and_convert_data(df_renamed)
  File "/home/gerardo/Documentos/GitHub/apu_filter/app/procesador_csv.py", line 616, in _clean_and_convert_data
    .apply(lambda code: clean_apu_code(code, **clean_code_params))
  File "/home/gerardo/miniconda3/envs/ap_filter_env/lib/python3.10/site-packages/pandas/core/series.py", line 4935, in apply
    ).apply()
  File "/home/gerardo/miniconda3/envs/ap_filter_env/lib/python3.10/site-packages/pandas/core/apply.py", line 1422, in apply
    return self.apply_standard()
  File "/home/gerardo/miniconda3/envs/ap_filter_env/lib/python3.10/site-packages/pandas/core/apply.py", line 1502, in apply_standard
    mapped = obj._map_values(
  File "/home/gerardo/miniconda3/envs/ap_filter_env/lib/python3.10/site-packages/pandas/core/base.py", line 925, in _map_values
    return algorithms.map_array(arr, mapper, na_action=na_action, convert=convert)
  File "/home/gerardo/miniconda3/envs/ap_filter_env/lib/python3.10/site-packages/pandas/core/algorithms.py", line 1743, in map_array
    return lib.map_infer(values, mapper, convert=convert)
  File "pandas/_libs/lib.pyx", line 2999, in pandas._libs.lib.map_infer
  File "/home/gerardo/Documentos/GitHub/apu_filter/app/procesador_csv.py", line 616, in <lambda>
    .apply(lambda code: clean_apu_code(code, **clean_code_params))
TypeError: clean_apu_code() got an unexpected keyword argument 'max_length'
16:50:00 - WARNING - ‚ö†Ô∏è  Se encontraron 54 insumos con descripciones normalizadas duplicadas. Se conservar√° el de mayor precio.
16:50:00 - INFO - ‚úÖ Insumos cargados: 115 insumos √∫nicos
16:50:00 - INFO - Iniciando parseo l√≠nea por l√≠nea de: apus_clean.csv
16:50:00 - INFO - Archivo le√≠do exitosamente con codificaci√≥n: MacRoman
16:50:01 - INFO - Parseo completo. Extra√≠dos 981 registros crudos.
16:50:01 - INFO - Parser Lark inicializado con arquitectura de especialistas
16:50:01 - INFO - Iniciando procesamiento de 981 APUs con especialistas
16:50:01 - INFO - Procesados 100/981 APUs
16:50:01 - INFO - Procesados 200/981 APUs
16:50:01 - INFO - Procesados 300/981 APUs
16:50:01 - INFO - Procesados 400/981 APUs
16:50:01 - INFO - Procesados 500/981 APUs
16:50:01 - INFO - Procesados 600/981 APUs
16:50:01 - INFO - Procesados 700/981 APUs
16:50:01 - INFO - Procesados 800/981 APUs
16:50:01 - INFO - Procesados 900/981 APUs
16:50:01 - INFO - Procesamiento completado: 0 insumos extra√≠dos
16:50:01 - WARNING - No se encontraron insumos v√°lidos
16:50:01 - ERROR - ‚ùå DataFrame 'presupuesto' est√° vac√≠o o es None
16:50:01 - ERROR - ‚ùå Error en el pipeline: DataFrame 'presupuesto' est√° vac√≠o o es None
Traceback (most recent call last):
  File "/home/gerardo/Documentos/GitHub/apu_filter/app/procesador_csv.py", line 1479, in _do_processing
    final_context = pipeline.run(initial_context)
  File "/home/gerardo/Documentos/GitHub/apu_filter/app/procesador_csv.py", line 112, in run
    context = step.execute(context)
  File "/home/gerardo/Documentos/GitHub/apu_filter/app/procesador_csv.py", line 308, in execute
    raise ValueError(error)
ValueError: DataFrame 'presupuesto' est√° vac√≠o o es None
16:50:01 - INFO - ================================================================================
16:50:01 - ERROR - Error de procesamiento: Error en el pipeline: DataFrame 'presupuesto' est√° vac√≠o o es None
16:50:01 - ERROR - Error de procesamiento: Error en el pipeline: DataFrame 'presupuesto' est√° vac√≠o o es None
16:50:01 - INFO - 127.0.0.1 - - [16/Nov/2025 16:50:01] "POST /upload HTTP/1.1" 500 -