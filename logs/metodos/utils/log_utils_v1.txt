================================================ test session starts =================================================
platform linux -- Python 3.10.19, pytest-8.4.2, pluggy-1.6.0 -- /home/gerardo/miniconda3/envs/ap_filter_env/bin/python
cachedir: .pytest_cache
rootdir: /home/gerardo/Documentos/GitHub/apu_filter
configfile: pyproject.toml
collected 6 items                                                                                                    

tests/test_utils.py::TestUnitNormalization::test_normalize_unit_case_insensitive PASSED                        [ 16%]
tests/test_utils.py::TestUnitNormalization::test_normalize_unit_invalid_returns_und FAILED                     [ 33%]
tests/test_utils.py::TestUnitNormalization::test_normalize_unit_logging FAILED                                 [ 50%]
tests/test_utils.py::TestUnitNormalization::test_normalize_unit_mapping PASSED                                 [ 66%]
tests/test_utils.py::TestUnitNormalization::test_normalize_unit_standard_units FAILED                          [ 83%]
tests/test_utils.py::TestUnitNormalization::test_normalize_unit_with_extra_chars PASSED                        [100%]

====================================================== FAILURES ======================================================
___________________________ TestUnitNormalization.test_normalize_unit_invalid_returns_und ____________________________

self = <tests.test_utils.TestUnitNormalization testMethod=test_normalize_unit_invalid_returns_und>

    def test_normalize_unit_invalid_returns_und(self):
        """Prueba que unidades inválidas retornan 'UND'."""
        test_cases = [
            "",
            None,
            "INVALID_UNIT_XYZ",
            "@#$%",
            "123",
            "ABC",
            12345,  # Número
        ]
    
        for input_unit in test_cases:
            with self.subTest(input=input_unit):
                result = utils.normalize_unit(input_unit)
>               self.assertEqual(result, 'UND')
E               AssertionError: 'INVALID_UNIT_XYZ' != 'UND'
E               - INVALID_UNIT_XYZ
E               + UND

tests/test_utils.py:463: AssertionError
_________________________________ TestUnitNormalization.test_normalize_unit_logging __________________________________

self = <tests.test_utils.TestUnitNormalization testMethod=test_normalize_unit_logging>

    def test_normalize_unit_logging(self):
        """Prueba que se registren logs para unidades no reconocidas."""
>       with patch('utils.logger.debug') as mock_debug:

tests/test_utils.py:467: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../miniconda3/envs/ap_filter_env/lib/python3.10/unittest/mock.py:1431: in __enter__
    self.target = self.getter()
../../../miniconda3/envs/ap_filter_env/lib/python3.10/unittest/mock.py:1618: in <lambda>
    getter = lambda: _importer(target)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

target = 'utils.logger'

    def _importer(target):
        components = target.split('.')
        import_path = components.pop(0)
>       thing = __import__(import_path)
E       ModuleNotFoundError: No module named 'utils'

../../../miniconda3/envs/ap_filter_env/lib/python3.10/unittest/mock.py:1257: ModuleNotFoundError
______________________________ TestUnitNormalization.test_normalize_unit_standard_units ______________________________

self = <tests.test_utils.TestUnitNormalization testMethod=test_normalize_unit_standard_units>

    def test_normalize_unit_standard_units(self):
        """Prueba normalización de unidades estándar."""
        # Probar todas las unidades en STANDARD_UNITS
        for unit in utils.STANDARD_UNITS:
            with self.subTest(unit=unit):
                result = utils.normalize_unit(unit.lower())
>               self.assertEqual(result, unit)
E               AssertionError: 'VIAJE' != 'VIAJES'
E               - VIAJE
E               + VIAJES
E               ?      +

tests/test_utils.py:406: AssertionError
============================================== short test summary info ===============================================
FAILED tests/test_utils.py::TestUnitNormalization::test_normalize_unit_invalid_returns_und - AssertionError: 'INVALID_UNIT_XYZ' != 'UND'
- INVALID_UNIT_XYZ
+ UND
FAILED tests/test_utils.py::TestUnitNormalization::test_normalize_unit_logging - ModuleNotFoundError: No module named 'utils'
FAILED tests/test_utils.py::TestUnitNormalization::test_normalize_unit_standard_units - AssertionError: 'VIAJE' != 'VIAJES'
- VIAJE
+ VIAJES
?      +
============================================ 3 failed, 3 passed in 2.50s =============================================

================================================ test session starts =================================================
platform linux -- Python 3.10.19, pytest-8.4.2, pluggy-1.6.0 -- /home/gerardo/miniconda3/envs/ap_filter_env/bin/python
cachedir: .pytest_cache
rootdir: /home/gerardo/Documentos/GitHub/apu_filter
configfile: pyproject.toml
collected 7 items                                                                                                    

tests/test_utils.py::TestNumericConversion::test_detect_decimal_separator PASSED                               [ 14%]
tests/test_utils.py::TestNumericConversion::test_parse_number_basic_types PASSED                               [ 28%]
tests/test_utils.py::TestNumericConversion::test_parse_number_currency_formats FAILED                          [ 42%]
tests/test_utils.py::TestNumericConversion::test_parse_number_decimal_separator_detection FAILED               [ 57%]
tests/test_utils.py::TestNumericConversion::test_parse_number_edge_cases FAILED                                [ 71%]
tests/test_utils.py::TestNumericConversion::test_parse_number_explicit_separator PASSED                        [ 85%]
tests/test_utils.py::TestNumericConversion::test_parse_number_special_values FAILED                            [100%]

====================================================== FAILURES ======================================================
______________________________ TestNumericConversion.test_parse_number_currency_formats ______________________________

self = <tests.test_utils.TestNumericConversion testMethod=test_parse_number_currency_formats>

    def test_parse_number_currency_formats(self):
        """Prueba conversión con símbolos de moneda."""
        test_cases = [
            ("$1,234.56", 1234.56),
            ("€ 1.234,56", 1234.56),  # Formato europeo
            ("£999.99", 999.99),
            ("¥10,000", 10000.0),
            ("50%", 50.0),
            ("$ 100 ", 100.0),
        ]
    
        for input_val, expected in test_cases:
            with self.subTest(input=input_val):
                result = utils.parse_number(input_val)
>               self.assertAlmostEqual(result, expected, places=2)
E               AssertionError: 1.23456 != 1234.56 within 2 places (1233.3254399999998 difference)

tests/test_utils.py:231: AssertionError
________________________ TestNumericConversion.test_parse_number_decimal_separator_detection _________________________

self = <tests.test_utils.TestNumericConversion testMethod=test_parse_number_decimal_separator_detection>

    def test_parse_number_decimal_separator_detection(self):
        """Prueba detección automática del separador decimal."""
        test_cases = [
            ("1,234.56", 1234.56),    # Formato US: coma para miles
            ("1.234,56", 1234.56),    # Formato EU: punto para miles
            ("1234,56", 1234.56),     # Solo coma decimal
            ("1234.56", 1234.56),     # Solo punto decimal
            ("1,000", 1000.0),        # Coma para miles (3 dígitos después)
            ("1,50", 1.50),           # Coma decimal (menos de 3 dígitos)
        ]
    
        for input_val, expected in test_cases:
            with self.subTest(input=input_val):
                result = utils.parse_number(input_val, decimal_separator="auto")
>               self.assertAlmostEqual(result, expected, places=2)
E               AssertionError: 1.23456 != 1234.56 within 2 places (1233.3254399999998 difference)

tests/test_utils.py:247: AssertionError
_________________________________ TestNumericConversion.test_parse_number_edge_cases _________________________________

self = <tests.test_utils.TestNumericConversion testMethod=test_parse_number_edge_cases>

    def test_parse_number_edge_cases(self):
        """Prueba casos límite en conversión numérica."""
        test_cases = [
            ("abc", 0.0),                    # Texto no numérico
            ("12.34.56.78", 12345678.0),     # Múltiples puntos
            ("1.234.567,89", 1234567.89),    # Formato EU complejo
            ("-", 0.0),                      # Solo signo
            ("+", 0.0),                      # Solo signo positivo
            ("1.2.3", 12.3),                 # Múltiples puntos, último como decimal
        ]
    
        for input_val, expected in test_cases:
            with self.subTest(input=input_val):
                result = utils.parse_number(input_val)
>               self.assertAlmostEqual(result, expected, places=2)
E               AssertionError: 123456.78 != 12345678.0 within 2 places (12222221.22 difference)

tests/test_utils.py:273: AssertionError
_______________________________ TestNumericConversion.test_parse_number_special_values _______________________________

self = <tests.test_utils.TestNumericConversion testMethod=test_parse_number_special_values>

    def test_parse_number_special_values(self):
        """Prueba manejo de valores especiales."""
        test_cases = [
            (None, 0.0),
            ("", 0.0),
            ("   ", 0.0),
            (float('nan'), 0.0),
            (np.nan, 0.0),
            (float('inf'), 0.0),
            (float('-inf'), 0.0),
            (pd.NA, 0.0),  # Pandas NA
        ]
    
        for input_val, expected in test_cases:
            with self.subTest(input=str(input_val)):
                result = utils.parse_number(input_val)
>               self.assertEqual(result, expected)
E               AssertionError: inf != 0.0

tests/test_utils.py:215: AssertionError
============================================== short test summary info ===============================================
FAILED tests/test_utils.py::TestNumericConversion::test_parse_number_currency_formats - AssertionError: 1.23456 != 1234.56 within 2 places (1233.3254399999998 difference)
FAILED tests/test_utils.py::TestNumericConversion::test_parse_number_decimal_separator_detection - AssertionError: 1.23456 != 1234.56 within 2 places (1233.3254399999998 difference)
FAILED tests/test_utils.py::TestNumericConversion::test_parse_number_edge_cases - AssertionError: 123456.78 != 12345678.0 within 2 places (12222221.22 difference)
FAILED tests/test_utils.py::TestNumericConversion::test_parse_number_special_values - AssertionError: inf != 0.0
============================================ 4 failed, 3 passed in 2.02s =============================================
