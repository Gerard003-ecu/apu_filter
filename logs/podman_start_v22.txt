[2025-12-02 13:49:47] [INFO] === Iniciando Despliegue de APU Filter Ecosystem ===
[2025-12-02 13:49:47] [INFO] Log file: ./logs/podman_start_20251202_134947.log
[2025-12-02 13:49:47] [INFO] Verificando configuración de registros...
[2025-12-02 13:49:47] [INFO] Ejecutando setup_podman_registry.sh...
Configuración de registros de Podman aplicada correctamente.
[2025-12-02 13:49:47] [SUCCESS] Configuración de registros aplicada.
[2025-12-02 13:49:47] [INFO] Limpiando contenedores previos...
podman-compose version: 1.0.6
['podman', '--version', '']
using podman version: 4.9.3
** excluding:  set()
podman stop -t 10 apu_agent
Error: no container with name or ID "apu_agent" found: no such container
exit code: 125
podman stop -t 10 apu_core
Error: no container with name or ID "apu_core" found: no such container
exit code: 125
podman stop -t 10 apu_redis
Error: no container with name or ID "apu_redis" found: no such container
exit code: 125
podman rm apu_agent
Error: no container with ID or name "apu_agent" found: no such container
exit code: 1
podman rm apu_core
Error: no container with ID or name "apu_core" found: no such container
exit code: 1
podman rm apu_redis
Error: no container with ID or name "apu_redis" found: no such container
exit code: 1
['podman', 'ps', '--filter', 'label=io.podman.compose.project=apu', '-a', '--format', '{{ .Names }}']
[2025-12-02 13:49:51] [INFO] Construyendo imágenes (Core & Agent)...
podman-compose version: 1.0.6
['podman', '--version', '']
using podman version: 4.9.3
podman build -f ./infrastructure/Dockerfile.core -t apu-core:latest .
STEP 1/23: FROM python:3.10-slim
STEP 2/23: LABEL maintainer="equipo-desarrollo"       version="6.0"       description="Core API - Flask con PyTorch CPU"
--> d0021a3ba0f1
### Resto de pasos ok.
STEP 15/23: RUN python -c "import torch; v = torch.__version__; print(f'Verificando torch: {v}'); assert v == '2.5.1+cpu', f'FALLO: torch es {v}, debería ser 2.5.1+cpu'; print('[OK] torch==2.5.1+cpu confirmado')"
Verificando torch: 2.5.1+cpu
[OK] torch==2.5.1+cpu confirmado
--> 579339877cf0
STEP 16/23: RUN useradd --create-home --shell /bin/bash --uid 1000 --user-group apu_user &&     chown -R apu_user:apu_user /app &&     rm -f /tmp/constraints.txt requirements-original.txt
--> de3802ceb52b
STEP 17/23: USER apu_user
--> 0330533bbdb7
STEP 18/23: COPY --chown=apu_user:apu_user app/ /app/app/
--> 50283f8f772c
STEP 19/23: COPY --chown=apu_user:apu_user config/ /app/config/
--> 92511bc484ad
STEP 20/23: COPY --chown=apu_user:apu_user wsgi.py /app/wsgi.py
--> 22152c5be733
STEP 21/23: EXPOSE 5002
--> 53d7f2d6b350
STEP 22/23: HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3     CMD curl -f http://localhost:5002/health || exit 1
time="2025-12-02T14:05:22-05:00" level=warning msg="HEALTHCHECK is not supported for OCI image format and will be ignored. Must use `docker` format"
--> cc9d83f9c44e
STEP 23/23: CMD ["gunicorn", "--workers", "4", "--bind", "0.0.0.0:5002", "--timeout", "120", "wsgi:app"]
COMMIT apu-core:latest
time="2025-12-02T14:05:23-05:00" level=warning msg="HEALTHCHECK is not supported for OCI image format and will be ignored. Must use `docker` format"
--> c124e4ee3bdc
Successfully tagged localhost/apu-core:latest
c124e4ee3bdcd10306a7b68124f6aa78a0ef4780907caa2971e563bcc010ee40
exit code: 0
podman build -f ./infrastructure/Dockerfile.agent -t apu-agent:latest .
STEP 1/18: FROM python:3.10-slim
STEP 2/18: LABEL maintainer="equipo-desarrollo"       version="6.0"       description="Agente orquestador con PyTorch CPU"
--> Using cache 1110e037ee0d9ef16fc8171ba329166bc44f7495aac3d7a1cd6f320d2b0f08b4
--> 1110e037ee0d
STEP 3/18: ENV PYTHONUNBUFFERED=1     PYTHONDONTWRITEBYTECODE=1     PYTHONPATH=/app     PIP_NO_CACHE_DIR=1     PIP_DISABLE_PIP_VERSION_CHECK=1     PIP_ROOT_USER_ACTION=ignore
--> Using cache af9bc8ed4acd65de6e6de8aa9fdf4bb4d8292c520a9ffd4351361afd52c897b2
--> af9bc8ed4acd
STEP 4/18: WORKDIR /app
--> Using cache 45f8d3c1eabbf0eec3e2d18ab7d651c9c68402a1aa3202a66a0e0ecb1d6ab399
--> 45f8d3c1eabb
STEP 14/18: RUN python -c "import torch; v = torch.__version__; assert v == '2.5.1+cpu', f'FALLO: {v}'; print('[OK] torch==2.5.1+cpu')"
[OK] torch==2.5.1+cpu
--> 4e6e8c3b0ca0
STEP 15/18: RUN useradd --create-home --shell /bin/bash --uid 1000 --user-group apu_user &&     chown -R apu_user:apu_user /app &&     rm -f /tmp/constraints.txt req-*-original.txt
--> 85af71cd1625
STEP 16/18: USER apu_user
--> dd3c45b66145
STEP 17/18: COPY --chown=apu_user:apu_user agent/ /app/agent/
--> 1517e28cd386
STEP 18/18: ENTRYPOINT ["python", "-u", "-m", "agent.orchestrator"]
COMMIT apu-agent:latest
--> e04a8b401b9d
Successfully tagged localhost/apu-agent:latest
e04a8b401b9dd16f0e257b80c2c0808f3047a8df18ab0a5371009871b76a7513
exit code: 0
[2025-12-02 14:20:22] [SUCCESS] Imágenes construidas.
[2025-12-02 14:20:22] [INFO] Levantando servicios...
podman-compose version: 1.0.6
['podman', '--version', '']
using podman version: 4.9.3
** excluding:  set()
['podman', 'inspect', '-t', 'image', '-f', '{{.Id}}', 'apu-core:latest']
['podman', 'inspect', '-t', 'image', '-f', '{{.Id}}', 'apu-agent:latest']
['podman', 'ps', '--filter', 'label=io.podman.compose.project=apu', '-a', '--format', '{{ index .Labels "io.podman.compose.config-hash"}}']
podman volume inspect apu_redis_data || podman volume create apu_redis_data
['podman', 'volume', 'inspect', 'apu_redis_data']
Error: no such volume apu_redis_data
['podman', 'volume', 'create', '--label', 'io.podman.compose.project=apu', '--label', 'com.docker.compose.project=apu', 'apu_redis_data']
['podman', 'volume', 'inspect', 'apu_redis_data']
['podman', 'network', 'exists', 'apu_network']
['podman', 'network', 'create', '--label', 'io.podman.compose.project=apu', '--label', 'com.docker.compose.project=apu', '--driver', 'bridge', 'apu_network']
['podman', 'network', 'exists', 'apu_network']
podman run --name=apu_redis -d --label io.podman.compose.config-hash=9852a367cfb12d1faeae8a17142e5ef5423b05343c7958af7c8bd4b60f8df610 --label io.podman.compose.project=apu --label io.podman.compose.version=1.0.6 --label PODMAN_SYSTEMD_UNIT=podman-compose@apu.service --label com.docker.compose.project=apu --label com.docker.compose.project.working_dir=/home/gerardo/Documentos/GitHub/apu_filter --label com.docker.compose.project.config_files=compose.yaml --label com.docker.compose.container-number=1 --label com.docker.compose.service=redis -v apu_redis_data:/data --net apu_network --network-alias redis -p 6379:6379 --hostname redis --restart unless-stopped --healthcheck-command /bin/sh -c redis-cli' 'ping --healthcheck-interval 10s --healthcheck-timeout 5s --healthcheck-start-period 10s --healthcheck-retries 5 docker.io/library/redis:7-alpine redis-server --appendonly yes --maxmemory 256mb --maxmemory-policy allkeys-lru
Trying to pull docker.io/library/redis:7-alpine...
Getting image source signatures
Copying blob sha256:f637881d1138581d892d9eb942c56e0ccc7758fe3bdc0f1e6cd66059fdfd8185
Copying blob sha256:232f7549c9b07a752bb00c7d7a61b3bfe6af3f15a711ba643c132f0e51922a64
Copying blob sha256:60c57c0072ef228501beec5a8bee0d7ecc882dee9afd91fc7a58e3f9d9da64c5
Copying blob sha256:fc4343b4accd46fa853b1de6ee0ca92ab1f7080db3af6c4948678534d69cc159
Copying blob sha256:380e8aa8b1fdbd2887f9b1fa3e9d3cba192f9ff87956981dc8bd73cc6da39bfc
Copying blob sha256:c70aae7b5e0d75367bcf5d40074ae8e28d17793c251e0d505321aa8ea4fd91fd
Copying blob sha256:4f4fb700ef54461cfa02571ae0db9a0dc1e0cdb5577484a6d75e68dc38e8acc1
Copying blob sha256:d75b3becd998021da3bbfcb31fa6580676396f5244243670f57920652cce8038
Copying config sha256:13105d2858ded45aedf7b24f0870e6a4e7ce4964924bffce68e562ca72149f1e
Writing manifest to image destination
14b4df4976042a57c3d795ba9a0084feb69d184524ab01df116577319db18e71
exit code: 0
['podman', 'network', 'exists', 'apu_network']
podman run --name=apu_core -d --requires=apu_redis --label io.podman.compose.config-hash=9852a367cfb12d1faeae8a17142e5ef5423b05343c7958af7c8bd4b60f8df610 --label io.podman.compose.project=apu --label io.podman.compose.version=1.0.6 --label PODMAN_SYSTEMD_UNIT=podman-compose@apu.service --label com.docker.compose.project=apu --label com.docker.compose.project.working_dir=/home/gerardo/Documentos/GitHub/apu_filter --label com.docker.compose.project.config_files=compose.yaml --label com.docker.compose.container-number=1 --label com.docker.compose.service=core --env-file /home/gerardo/Documentos/GitHub/apu_filter/.env -e REDIS_URL=redis://redis:6379/0 -e FLASK_ENV=production -e PYTHONUNBUFFERED=1 -e PYTHONPATH=/app -v /home/gerardo/Documentos/GitHub/apu_filter/data:/app/data:Z -v /home/gerardo/Documentos/GitHub/apu_filter/logs:/app/logs:Z -v /home/gerardo/Documentos/GitHub/apu_filter/config:/app/config:Z,ro --net apu_network --network-alias core -p 5002:5002 --hostname core --pull never --restart unless-stopped --healthcheck-command /bin/sh -c curl' '-f' 'http://localhost:5002/health --healthcheck-interval 30s --healthcheck-timeout 10s --healthcheck-start-period 90s --healthcheck-retries 3 apu-core:latest
Error: parsing file "/home/gerardo/Documentos/GitHub/apu_filter/.env": open /home/gerardo/Documentos/GitHub/apu_filter/.env: no such file or directory
exit code: 125
podman start apu_core
Error: no container with name or ID "apu_core" found: no such container
exit code: 125
['podman', 'network', 'exists', 'apu_network']
podman run --name=apu_agent -d --requires=apu_redis,apu_core --label io.podman.compose.config-hash=9852a367cfb12d1faeae8a17142e5ef5423b05343c7958af7c8bd4b60f8df610 --label io.podman.compose.project=apu --label io.podman.compose.version=1.0.6 --label PODMAN_SYSTEMD_UNIT=podman-compose@apu.service --label com.docker.compose.project=apu --label com.docker.compose.project.working_dir=/home/gerardo/Documentos/GitHub/apu_filter --label com.docker.compose.project.config_files=compose.yaml --label com.docker.compose.container-number=1 --label com.docker.compose.service=agent --env-file /home/gerardo/Documentos/GitHub/apu_filter/.env -e CORE_API_URL=http://core:5002 -e REDIS_URL=redis://redis:6379/0 -e PYTHONUNBUFFERED=1 -e PYTHONPATH=/app -v /home/gerardo/Documentos/GitHub/apu_filter/logs:/app/logs:Z --net apu_network --network-alias agent --hostname agent --pull never --restart unless-stopped apu-agent:latest
Error: parsing file "/home/gerardo/Documentos/GitHub/apu_filter/.env": open /home/gerardo/Documentos/GitHub/apu_filter/.env: no such file or directory
exit code: 125
podman start apu_agent
Error: no container with name or ID "apu_agent" found: no such container
exit code: 125
[2025-12-02 14:20:47] [INFO] Esperando estabilización (10s)...
[2025-12-02 14:20:57] [INFO] Estado de los contenedores:
[2025-12-02 14:21:00] [SUCCESS] === APU Filter Ecosystem Operativo ===
